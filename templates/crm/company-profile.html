{% extends 'crm/base.html' %}

{% block content %}

<style>
    .card {
      border: none;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      border-radius: 10px;
    }
    .object-cover {
      object-fit: cover;
    }
    .card-body h3 {
      font-size: 1.5rem;
      font-weight: 600;
    }
    .card-body .btn {
      background-color: #6c63ff;
      color: #fff;
      font-weight: 500;
    }
    .card-body .btn:hover {
      background-color: #574bce;
    }
    .edit-icon {
      position: absolute;
      top: 10px;
      right: 10px;
      cursor: pointer;
      color: #6c63ff;
    }
    .vacancy-card {
        border-left: 4px solid #6c63ff;
    }
    .vacancy-status-badge {
        font-size: 0.75rem;
    }
    .bg-light-primary {
      background-color: #e3f2fd;
    }
    .bg-gradient-primary {
      background: linear-gradient(135deg, #1976d2, #2196f3);
    }
    .info-item {
      display: flex;
      align-items: flex-start;
    }
    .info-label {
      width: 180px;
      color: #616161;
      font-weight: 500;
    }
    .card {
      border-radius: 10px;
      overflow: hidden;
    }
    .card-header {
      border-bottom: none;
      padding: 1rem 1.25rem;
    }
    .activity-feed {
      padding: 0 1.5rem;
    }
    .activity-item {
      display: flex;
      padding: 1.5rem 0;
      border-bottom: 1px solid #f0f0f0;
      position: relative;
    }
    .activity-item.first-item {
      padding-top: 1rem;
    }
    .activity-avatar {
      margin-right: 1rem;
      flex-shrink: 0;
    }
    .avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      background-size: cover;
      background-position: center;
    }
    .activity-content {
      flex-grow: 1;
    }
    .activity-header {
      display: flex;
      justify-content: space-between;
      margin-bottom: 0.5rem;
    }
    .activity-user {
      line-height: 1.2;
    }
    .activity-user span {
      display: block;
      font-size: 0.8rem;
    }
    .activity-meta {
      text-align: right;
    }
    .activity-meta span {
      display: block;
      font-size: 0.8rem;
    }
    .activity-changes, .activity-remark {
      margin-top: 1rem;
      border-radius: 6px;
      padding: 0.75rem;
    }
    .changes-header, .remark-header {
      display: flex;
      align-items: center;
      color: #666;
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 0.5rem;
    }
    .changes-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 0.75rem;
    }
    .change-item {
      font-size: 0.9rem;
    }
    .change-field {
      font-weight: 500;
      margin-bottom: 0.25rem;
    }
    .change-values div {
      margin-bottom: 0.2rem;
    }
    .change-label {
      font-size: 0.8rem;
      color: #666;
      margin-right: 0.5rem;
    }
    .remark-content {
      font-size: 0.9rem;
      line-height: 1.5;
    }
    .empty-state {
      text-align: center;
      padding: 3rem 0;
    }
    .empty-icon {
      font-size: 2.5rem;
      color: #ddd;
      margin-bottom: 1rem;
    }
    .empty-state h5 {
      margin-bottom: 0.5rem;
    }
    @media (max-width: 768px) {
      .activity-header {
        flex-direction: column;
      }
      .activity-meta {
        text-align: left;
        margin-top: 0.5rem;
      }
      .changes-grid {
        grid-template-columns: 1fr;
      }
    }
</style>

<div class="container py-4">
  <div class="d-flex justify-content-between py-3">
    <h4>Company Details</h4>
    <div>
      <a href="{% url 'admin_company_communication_list' company.id %}" class="btn btn-sm btn-outline-primary">Communication Record</a>
      <a href="{% url 'admin_company_contacts_list' company.id %}" class="btn btn-sm btn-outline-primary">Employee Details</a>
    </div>
  </div>
  
  <div class="row g-4">
    <!-- Company Profile Card -->
    <div class="col-lg-6">
      <div class="card h-100">
        <div class="card-header d-flex justify-content-between align-items-center">
          <h5 class="mb-0">Company Profile</h5>
          <a href="#" class="btn btn-sm btn-outline-primary" data-bs-toggle="modal" data-bs-target="#modal-profile">
            <i class="bi bi-pencil"></i> Edit
          </a>
        </div>
        <div class="card-body">
          <div class="d-flex flex-column flex-md-row gap-4">
            <div class="text-center">
              {% if company.company_logo %}
                <img src="{{company.company_logo.url}}" class="rounded-circle object-cover" 
                     style="width: 150px; height: 150px;" alt="Company Logo">
              {% else %}
                <div class="d-flex align-items-center justify-content-center bg-light rounded-circle" 
                     style="width: 150px; height: 150px;">
                  <span class="text-muted">No Logo</span>
                </div>
              {% endif %}
            </div>
            
            <div class="flex-grow-1">
              <h3 class="mb-2">{{ company.company_name }}</h3>
              <p class="text-muted mb-3">{{ company.company_unique_code }}</p>
              
              <div class="row g-2">
                <div class="col-md-6">
                  <div class="mb-2">
                    <strong class="d-block text-muted small">Location</strong>
                    {{ company.company_location }}
                  </div>
                  <div class="mb-2">
                    <strong class="d-block text-muted small">Email</strong>
                    {{ company.company_email_address|default:"-" }}
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="mb-2">
                    <strong class="d-block text-muted small">Handled By</strong>
                    {{ company.handled_by }}
                  </div>
                
                
                  <div class="mb-2">
                    <strong class="d-block text-muted small">Opened By</strong>
                    {{ company.opened_by }}
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Employment Details Card -->
    <div class="col-lg-6">
      <div class="card h-100">
        <div class="card-header d-flex justify-content-between align-items-center">
          <h5 class="mb-0">Employment Details</h5>
          <a href="#" class="btn btn-sm btn-outline-primary" data-bs-toggle="modal" data-bs-target="#modal-company-details">
            <i class="bi bi-pencil"></i> Edit
          </a>
        </div>
        <div class="card-body">
          <div class="row">
            <div class="col-md-6">
              <div class="mb-3">
                <strong class="d-block text-muted small">Contact Person</strong>
                {{ company.company_contact_person_name }}
              </div>
              <div class="mb-3">
                <strong class="d-block text-muted small">Designation</strong>
                {{ company.company_contact_person_designation|default:"-" }}
              </div>
              <div class="mb-3">
                <strong class="d-block text-muted small">Contact</strong>
                {{ company.company_contact_person_contact_details|default:"-" }}
              </div>
              <div class="mb-3">
                <strong class="d-block text-muted small">Interview Address</strong>
                {{ company.interview_address|default:"-" }}
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Company Remarks Card -->
    <div class="col-lg-6">
      <div class="card h-100">
        <div class="card-header d-flex justify-content-between align-items-center">
          <h5 class="mb-0">Company Remarks</h5>
          <a href="#" class="btn btn-sm btn-outline-primary" data-bs-toggle="modal" data-bs-target="#modal-calling-remark">
            <i class="bi bi-pencil"></i> Edit
          </a>
        </div>
        <div class="card-body">
          <div class="row">
            <div class="col-md-6">
              <div class="mb-3">
                <strong class="d-block text-muted small">Proposal Status</strong>
                {{ company.status_of_proposal|default:"-" }}
              </div>
              <div class="mb-3">
                <strong class="d-block text-muted small">Payment Condition</strong>
                {{ company.payment_condiation|default:"-" }}
              </div>
            </div>
            
            <div class="col-md-6">
              <div class="mb-3">
                <strong class="d-block text-muted small">Invoice Date</strong>
                {{ company.invoice_generation_date |default:"-" }}
              </div>
              <div class="mb-3">
                <strong class="d-block text-muted small">Payout Date</strong>
                {{ company.payout_date|default:"-" }}
              </div>
              <div class="mb-3">
                <strong class="d-block text-muted small">Remarks</strong>
                {{ company.remark|default:"-" }}
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Vacancies Card -->
    <div class="col-lg-6">
      <div class="card">
        <div class="card-header d-flex justify-content-between align-items-center">
          <h3 class="card-title">Vacancies</h3>
          <button class="btn btn-sm btn-outline-primary" data-bs-toggle="modal" data-bs-target="#addVacancyModal">
            Add New Vacancy
          </button>
        </div>
        <div class="card-body">
          <div class="table-responsive">
            <table class="table table-vcenter">
              <thead>
                <tr>
                  <th>Job Profile</th>
                  <th>Vacancy Code</th>
                  <th>Status</th>
                  <th>Opening Date</th>
                  <th>Closing Date</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                {% for vacancy in company.vacancies.all %}
                <tr>
                  <td>{{ vacancy.job_profile }}</td>
                  <td>{{ vacancy.company_vacancy_unique_code }}</td>
                  <td>
                    <span class="badge text-white {% if vacancy.vacancy_status == 'Active' %}bg-green{% elif vacancy.vacancy_status == 'Closed' %}bg-red{% else %}bg-yellow{% endif %}">
                      {{ vacancy.vacancy_status }}
                    </span>
                  </td>
                  <td>{{ vacancy.vacancy_opening_date|date:"d M Y" }}</td>
                  <td>{{ vacancy.vacancy_closing_date|date:"d M Y"|default:"-" }}</td>
                  <td>
                    <div class="btn-group gap-1">
                      <button type="button" class="btn btn-sm btn-primary rounded" data-bs-toggle="modal" data-bs-target="#viewVacancyModal{{ vacancy.id }}">
                        <i class="fas fa-eye"></i>
                      </button>
                      <button type="button" class="btn btn-sm btn-warning rounded" data-bs-toggle="modal" data-bs-target="#editVacancyModal{{ vacancy.id }}">
                        <i class="fas fa-edit"></i>
                      </button>
                      <button type="button" class="btn btn-sm btn-danger rounded" data-bs-toggle="modal" data-bs-target="#deleteVacancyModal{{ vacancy.id }}">
                        <i class="fas fa-trash"></i>
                      </button>
                    </div>
                  </td>
                </tr>
                {% empty %}
                <tr>
                  <td colspan="6" class="text-center">No vacancies found</td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Activity Timeline -->
  <div class="row mt-4">
    <div class="col-12">
      <div class="card">
        <div class="card-header border-0">
          <h3 class="card-title mb-0">Activity History</h3>
          <small class="text-muted">All changes for company and vacancies</small>
        </div>
        <div class="card-body p-0">
          <div class="activity-feed">
            {% for activity in activities %}
              <div class="activity-item {% if forloop.first %}first-item{% endif %}">
                <div class="activity-avatar">
                  {% with employee=activity.get_employee %}
                    {% if employee and employee.employee_photo %}
                      <img src="{{ employee.employee_photo.url }}" class="avatar" alt="{{ employee.first_name }}">
                    {% else %}
                      <div class="avatar bg-primary text-white">
                        {% if employee %}
                          {{ employee.first_name|first }}{{ employee.last_name|first }}
                        {% else %}
                          {{ activity.employee.username|first }}
                        {% endif %}
                      </div>
                    {% endif %}
                  {% endwith %}
                </div>
                
                <div class="activity-content">
                  <div class="activity-header">
                    <div class="activity-user">
                      <strong>
                        {% with employee=activity.get_employee %}
                          {% if employee %}
                            {{ employee.first_name }} {{ employee.last_name }}
                            <small class="text-muted">({{ employee.designation }})</small>
                          {% else %}
                            {{ activity.employee.username }}
                          {% endif %}
                        {% endwith %}
                      </strong>
                      <span class="text-muted">{{ activity.get_content_type_display }}</span>
                    </div>
                    <div class="activity-meta">
                      <span class="text-muted">{{ activity.timestamp|date:"M d, Y h:i A" }}</span>
                      <div class="d-flex align-items-center mt-1">
                        <span class="badge text-white bg-{% if activity.action == 'created' %}success{% elif activity.action == 'status_changed' %}warning text-dark{% else %}info{% endif %} me-2">
                          {{ activity.get_action_display }}
                        </span>
                        {% if activity.form_used %}
                          <small class="text-muted">via {{ activity.form_used }}</small>
                        {% endif %}
                      </div>
                    </div>
                  </div>
                  
                  <div class="activity-target mb-2">
                    <i class="fas fa-bullseye me-2"></i>
                    <strong>{{ activity.get_target }}</strong>
                  </div>
                  
                  {% if activity.changes and 'initial' not in activity.changes %}
                  <div class="activity-changes">
                    <div class="changes-header">
                      <i class="fas fa-exchange-alt me-2"></i>
                      <small>MODIFIED FIELDS</small>
                    </div>
                    <div class="changes-grid">
                      {% for field, values in activity.changes.items %}
                        <div class="change-item">
                          <div class="change-field">{{ field|title }}</div>
                          <div class="change-values">
                            {% if values.old %}
                            <div class="old-value">
                              <span class="change-label">Before:</span>
                              <span class="text-danger">{{ values.old|truncatechars:40 }}</span>
                            </div>
                            {% endif %}
                            {% if values.new %}
                            <div class="new-value">
                              <span class="change-label">After:</span>
                              <span class="text-success">{{ values.new|truncatechars:40 }}</span>
                            </div>
                            {% endif %}
                          </div>
                        </div>
                      {% endfor %}
                    </div>
                  </div>
                  {% endif %}
                  
                  {% if activity.remark %}
                  <div class="activity-remark">
                    <div class="remark-header">
                      <i class="fas fa-comment-dots me-2"></i>
                      <small>REMARKS</small>
                    </div>
                    <div class="remark-content">
                      {{ activity.remark|linebreaks }}
                    </div>
                  </div>
                  {% endif %}
                </div>
              </div>
            {% empty %}
              <div class="empty-state">
                <div class="empty-icon">
                  <i class="fas fa-history"></i>
                </div>
                <h5>No activity recorded yet</h5>
                <p class="text-muted">All changes will appear here</p>
              </div>
            {% endfor %}
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modals -->
<!-- Company Profile Modal -->
<div class="modal modal-blur fade" id="modal-profile" tabindex="-1" role="dialog" aria-hidden="true">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Company Profile</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form id="profileForm" method="POST" enctype="multipart/form-data" novalidate>
          {% csrf_token %}
          <div class="row">
            <div class="col-md-6 mb-3">
              <label class="form-label">Handled By</label>
              <select class="form-select" name="handled_by" required>
                <option value="" disabled selected>Select Employee</option>
                {% for employee in employees %}
                  <option value="{{ employee.first_name }} {{ employee.last_name }} ({{ employee.employee_id }})" {% if company.handled_by == employee.first_name|add:" "|add:employee.last_name|add:" ("|add:employee.employee_id|add:")" %}selected{% endif %}>
                    {{ employee.first_name }} {{ employee.last_name }} ({{ employee.employee_id }})
                  </option>
                {% endfor %}
              </select>
              <div class="invalid-feedback">
                Please provide a valid handled by name (2-100 characters, alphabets only).
              </div>
            </div>

            <div class="col-md-6 mb-3">
              <label class="form-label">Opened By</label>
              <select class="form-select" name="opened_by" required>
                <option value="" disabled selected>Select Employee</option>
                {% for employee in employees %}
                  <option value="{{ employee.first_name }} {{ employee.last_name }} ({{ employee.employee_id }})" {% if company.opened_by == employee.first_name|add:" "|add:employee.last_name|add:" ("|add:employee.employee_id|add:")" %}selected{% endif %}>
                    {{ employee.first_name }} {{ employee.last_name }} ({{ employee.employee_id }})
                  </option>
                {% endfor %}
              </select>
              <div class="invalid-feedback">
                Please provide a valid Opened by name (2-100 characters, alphabets only).
              </div>
            </div>
            
            <div class="col-md-6 mb-3">
              <label class="form-label">Company Name</label>
              <input type="text" class="form-control" name="company_name" value="{{ company.company_name }}" 
                     required minlength="2" maxlength="100" />
              <div class="invalid-feedback">
                Please provide a company name (2-100 characters).
              </div>
            </div>
            
            <div class="col-md-6 mb-3">
              <label class="form-label">Company Logo</label>
              <input type="file" class="form-control" name="company_logo" 
                     accept="image/png, image/jpeg, image/jpg" />
              <div class="invalid-feedback">
                Please upload a valid image file (PNG, JPG, JPEG).
              </div>
            </div>
            
            <div class="col-md-6 mb-3">
              <label class="form-label">Company Location</label>
              <input type="text" class="form-control" name="company_location" value="{{ company.company_location }}" 
                     required minlength="5" maxlength="200" />
              <div class="invalid-feedback">
                Please provide a company location (5-200 characters).
              </div>
            </div>
            
            <div class="col-md-6 mb-3">
              <label class="form-label">Company Unique Code</label>
              <input type="text" class="form-control" name="company_unique_code" value="{{ company.company_unique_code }}" 
                     required minlength="3" maxlength="5"
                     pattern="^[a-zA-Z0-9\-_]*$" title="Only alphanumeric characters, hyphens and underscores are allowed" />
              <div class="invalid-feedback">
                Please provide a valid unique code (3-5 characters, alphanumeric only).
              </div>
            </div>
            
            <div class="col-md-6 mb-3">
              <label class="form-label">Email Address</label>
              <input type="email" class="form-control" name="company_email_address" value="{{ company.company_email_address }}" 
                     maxlength="100" pattern="^[^\s@]+@[^\s@]+\.[^\s@]+$"/>
              <div class="invalid-feedback">
                Please provide a valid email address.
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            <button type="submit" name="company_personal_information" class="btn btn-primary">Save Changes</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- Company Details Modal -->
<div class="modal modal-blur fade" id="modal-company-details" tabindex="-1" role="dialog" aria-hidden="true">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Company Details</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form id="companyDetailsForm" method="post" enctype="multipart/form-data" novalidate>
          {% csrf_token %}
          <h5 class="text-secondary">Company Information</h5>
          <div class="row">
            <div class="col-md-6 mb-3">
              <label class="form-label">Contact Person Name</label>
              <input type="text" class="form-control" name="company_contact_person_name" 
                     value="{{ company.company_contact_person_name }}" 
                     required minlength="2" maxlength="100"
                     pattern="^[a-zA-Z\s.]*$" 
                     title="Only alphabets, spaces and dots are allowed" />
              <div class="invalid-feedback">
                Please provide a valid contact person name (2-100 characters).
              </div>
            </div>
            
            <div class="col-md-6 mb-3">
              <label class="form-label">Contact Person Contact Details</label>
              <input type="text" class="form-control" name="company_contact_person_contact_details" 
                     value="{{ company.company_contact_person_contact_details }}"
                     maxlength="10"
                     pattern="[0-9]{10}" 
                     title="Only numbers, +, - and spaces are allowed" />
              <div class="invalid-feedback">
                Please provide valid contact details (numbers, +, - only).
              </div>
            </div>
            
            <div class="col-md-6 mb-3">
              <label class="form-label">Contact Person Designation</label>
              <input type="text" class="form-control" name="company_contact_person_designation" 
                     value="{{ company.company_contact_person_designation }}"
                     maxlength="50" />
              <div class="invalid-feedback">
                Designation should be less than 50 characters.
              </div>
            </div>
            
            <div class="col-md-6 mb-3">
              <label class="form-label">Interview Address</label>
              <input type="text" class="form-control" name="interview_address" 
                     value="{{ company.interview_address }}" 
                     required minlength="5" maxlength="200" />
              <div class="invalid-feedback">
                Please provide a valid interview address (5-200 characters).
              </div>
            </div>
          </div>
          
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            <button type="submit" name="company_details" class="btn btn-primary">Save Changes</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- Calling Remark Modal -->
<div class="modal modal-blur fade" id="modal-calling-remark" tabindex="-1" role="dialog" aria-hidden="true">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Calling Remark</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form id="callingRemarkForm" method="post" enctype="multipart/form-data" novalidate>
          {% csrf_token %}
          <div class="row">
            <div class="col-md-6 mb-3">
              <label class="form-label">Status of Proposal</label>
              <select class="form-select" name="status_of_proposal" required>
                <option value="" disabled>Select status</option>
                <option value="Draft" {% if company.status_of_proposal == 'Draft' %}selected{% endif %}>Draft</option>
                <option value="Submitted" {% if company.status_of_proposal == 'Submitted' %}selected{% endif %}>Submitted</option>
                <option value="Approved" {% if company.status_of_proposal == 'Approved' %}selected{% endif %}>Approved</option>
                <option value="Rejected" {% if company.status_of_proposal == 'Rejected' %}selected{% endif %}>Rejected</option>
              </select>
              <div class="invalid-feedback">
                Please select proposal status (required).
              </div>
            </div>
            
            <div class="col-md-6 mb-3">
              <label class="form-label">Invoice Generation Date</label>
              <input type="date" class="form-control" name="invoice_generation_date" 
                     value="{{ company.invoice_generation_date }}" />
              <div class="invalid-feedback">
                Please enter a valid date (YYYY-MM-DD format).
              </div>
            </div>
            
            <div class="col-md-6 mb-3">
              <label class="form-label">Payout Date</label>
              <input type="date" class="form-control" name="payout_date" 
                     value="{{ company.payout_date }}" />
              <div class="invalid-feedback">
                Please enter a valid date (YYYY-MM-DD format).
              </div>
            </div>
            
            <div class="col-md-6 mb-3">
              <label class="form-label">Payment Condition</label>
              <select class="form-select" name="payment_condiation">
                <option value="" disabled>Select condition</option>
                <option value="Advance" {% if company.payment_condiation == 'Advance' %}selected{% endif %}>Advance</option>
                <option value="After Placement" {% if company.payment_condiation == 'After Placement' %}selected{% endif %}>After Placement</option>
                <option value="Installments" {% if company.payment_condiation == 'Installments' %}selected{% endif %}>Installments</option>
                <option value="NA" {% if company.payment_condiation == 'NA' %}selected{% endif %}>Not Applicable</option>
              </select>
              <div class="invalid-feedback">
                Please select a valid payment condition.
              </div>
            </div>
            
            <div class="col-md-6 mb-3">
              <label class="form-label">Remark</label>
              <textarea class="form-control" name="remark" 
                        maxlength="500">{{ company.remark }}</textarea>
              <div class="invalid-feedback">
                Remark should be less than 500 characters.
              </div>
            </div>
          </div>
          
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            <button type="submit" name="submit_calling_remark" class="btn btn-primary">Submit</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- Add Vacancy Modal -->
<div class="modal fade" id="addVacancyModal" tabindex="-1" aria-labelledby="addVacancyModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="addVacancyModalLabel">Add New Vacancy</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <form method="POST" id="vacancyForm">
        {% csrf_token %}
        <input type="hidden" name="add_vacancy" value="true">
        
        <div class="modal-body">
          <div class="row">
            <div class="col-md-6">
              <div class="mb-3">
                <label class="form-label">Job Profile</label>
                <input type="text" class="form-control" name="job_profile" required>
              </div>
            </div>
            <div class="col-md-6">
              <div class="mb-3">
                <label class="form-label">Vacancy Code</label>
                <input type="text" class="form-control" name="company_vacancy_unique_code" maxLength="5" required>
              </div>
            </div>
            <div class="col-md-4">
              <div class="mb-3">
                <label class="form-label">Opening Date</label>
                <input type="date" class="form-control" name="vacancy_opening_date" 
                       max="{{ today|date:'Y-m-d' }}" required>
              </div>
            </div>
            <div class="col-md-4">
              <div class="mb-3">
                <label class="form-label">Closing Date</label>
                <input type="date" class="form-control" name="vacancy_closing_date" 
                       min="{{ today|date:'Y-m-d' }}">
              </div>
            </div>
            <div class="col-md-4">
              <div class="mb-3">
                <label class="form-label">Status</label>
                <select name="vacancy_status" class="form-select" required>
                  <option value="Hold" selected>Hold</option>
                  <option value="Active">Active</option>
                  <option value="Closed">Closed</option>
                </select>
              </div>
            </div>
            <div class="col-md-6">
              <div class="mb-3">
                <label class="form-label">Job Opening Origin</label>
                <select name="job_opening_origin" class="form-select" required>
                  <option value="">Select Origin</option>
                  <option value="EVMS">EVMS</option>
                  <option value="Walk-In">Walk-In</option>
                  <option value="Job Hai">Job Hai</option>
                  <option value="Naukari">Naukari</option>
                  <option value="Apna">Apna</option>
                  <option value="Expertia">Expertia</option>
                  <option value="Instagram">Instagram</option>
                  <option value="Website">Website</option>
                  <option value="Indeed">Indeed</option>
                  <option value="Facebook">Facebook</option>
                  <option value="Linkedin">Linkedin</option>
                  <option value="Personal Refference">Personal Refference</option>
                  <option value="Other">Other</option>
                </select>
              </div>
            </div>
            <div class="col-md-6">
              <div class="mb-3">
                <label class="form-label">Sector</label>
                <select name="sector_type" class="form-select" required>
                  <option value="">Select Sector</option>
                  {% for sector in job_sectors %}
                  <option value="{{ sector }}">{{ sector }}</option>
                  {% endfor %}
                </select>
              </div>
            </div>
            <div class="col-md-6">
              <div class="mb-3">
                <label class="form-label">Department</label>
                <select name="department_name" class="form-select" required>
                  <option value="">Select Department</option>
                  {% for dept in departments %}
                  <option value="{{ dept }}">{{ dept }}</option>
                  {% endfor %}
                </select>
              </div>
            </div>
            <div class="col-md-6">
              <div class="mb-3">
                <label class="form-label">Payroll</label>
                <select name="payroll" class="form-select" id="payrollSelect" required>
                  <option value="">Select Option</option>
                  <option value="Self">Self</option>
                  <option value="Third Party">Third Party</option>
                </select>
              </div>
            </div>
            <div class="col-md-6" id="thirdPartyInput" style="display: none;">
              <div class="mb-3">
                <label class="form-label">Third-Party Name</label>
                <input type="text" name="third_party_name" class="form-control">
              </div>
            </div>
            <div class="col-md-6">
              <div class="mb-3">
                <label class="form-label">Fresher Allowed</label>
                <select name="fresher_status" class="form-select" required>
                  <option value="Both">Both</option>
                  <option value="Yes">Yes</option>
                  <option value="No">No</option>
                </select>
              </div>
            </div>
            <div class="col-md-6">
              <div class="mb-3">
                <label class="form-label">Gender Preference</label>
                <select name="gender" class="form-select" required>
                  <option value="Both">Both</option>
                  <option value="Male">Male</option>
                  <option value="Female">Female</option>
                </select>
              </div>
            </div>
            <div class="col-md-3">
              <div class="mb-3">
                <label class="form-label">Min Age</label>
                <input type="number" name="minimum_age" class="form-control" min="18" max="70" step="0.1">
              </div>
            </div>
            <div class="col-md-3">
              <div class="mb-3">
                <label class="form-label">Max Age</label>
                <input type="number" name="maximum_age" class="form-control" min="18" max="70" step="0.1">
              </div>
            </div>
            <div class="col-md-3">
              <div class="mb-3">
                <label class="form-label">Min Experience</label>
                <input type="number" name="minimum_experience" class="form-control" min="0" max="50" step="0.1">
              </div>
            </div>
            <div class="col-md-3">
              <div class="mb-3">
                <label class="form-label">Max Experience</label>
                <input type="number" name="maximum_experience" class="form-control" min="0" max="50" step="0.1">
              </div>
            </div>
            <div class="col-md-4">
              <div class="mb-3">
                <label class="form-label">Qualification</label>
                <select name="minimum_education_qualification" class="form-select" required>
                  <option value="">Select Qualification</option>
                  <option value="Secondary School">Secondary School</option>
                  <option value="Higher Secondary School">Higher Secondary School</option>
                  <option value="Graduate">Graduate</option>
                  <option value="Post-Graduate">Post-Graduate</option>
                  <option value="Ph.D.">Ph.D.</option>
                  <option value="Others">Others</option>
                </select>
              </div>
            </div>
            <div class="col-md-4">
              <div class="mb-3">
                <label class="form-label">Specialization</label>
                <input type="text" name="specialization" class="form-control">
              </div>
            </div>
            <div class="col-md-4">
              <div class="mb-3">
                <label class="form-label">Status of Incentive</label>
                <select name="status_of_incentive" class="form-select" required>
                  <option value="No">No</option>
                  <option value="Yes">Yes</option>
                </select>
              </div>
            </div>
            <div class="col-md-6">
              <div class="mb-3">
                <label class="form-label">Min Salary</label>
                <input type="number" name="minimum_salary_range" class="form-control" min="0" step="1" required>
              </div>
            </div>
            <div class="col-md-6">
              <div class="mb-3">
                <label class="form-label">Max Salary</label>
                <input type="number" name="maximum_salary_range" class="form-control" min="0" step="1">
              </div>
            </div>
            <div class="col-md-12">
              <div class="mb-3">
                <label class="form-label">Special Instructions</label>
                <input type="text" name="special_instruction" class="form-control">
              </div>
            </div>
            <div class="col-md-12">
              <div class="mb-3">
                <label class="form-label">Company USP</label>
                <input type="text" name="company_usp" class="form-control">
              </div>
            </div>
            <div class="col-md-12">
              <div class="mb-3">
                <label class="form-label">Replacement Criteria</label>
                <textarea name="replacement_criteria" class="form-control" rows="2"></textarea>
              </div>
            </div>
          </div>
        </div>

        <!-- Payment Section -->
<div class="card mt-4">
  <div class="card-header bg-primary text-white">
    <h5 class="mb-0">Payment Details</h5>
  </div>
  <div class="card-body">
    <div class="row">
      <div class="col-md-12">
        <div class="mb-3">
          <label class="form-label">Payment Mode <span class="text-danger">*</span></label>
          <div class="d-flex flex-wrap gap-3">
            <div class="form-check">
              <input class="form-check-input" type="radio" name="payment_mode" id="companyPayRadio" value="Company Pay" required>
              <label class="form-check-label" for="companyPayRadio">Company Pay</label>
            </div>
            <div class="form-check">
              <input class="form-check-input" type="radio" name="payment_mode" id="salaryDeductionRadio" value="Salary Deduction">
              <label class="form-check-label" for="salaryDeductionRadio">Salary Deduction</label>
            </div>
            <div class="form-check">
              <input class="form-check-input" type="radio" name="payment_mode" id="spdcPayRadio" value="SPDC/Candidate Pay">
              <label class="form-check-label" for="spdcPayRadio">SPDC/Candidate Pay</label>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Company Pay Fields -->
    <div id="companyPayFields" style="display: none;">
      <div class="row">
        <div class="col-md-12">
          <div class="mb-3">
            <label class="form-label">Payment Type <span class="text-danger">*</span></label>
            <div class="d-flex flex-wrap gap-3">
              <div class="form-check">
                <input class="form-check-input" type="radio" name="company_pay_type" id="flatTypeRadio" value="Flat">
                <label class="form-check-label" for="flatTypeRadio">Flat</label>
              </div>
              <div class="form-check">
                <input class="form-check-input" type="radio" name="company_pay_type" id="percentageTypeRadio" value="Percentage of CTC">
                <label class="form-check-label" for="percentageTypeRadio">% of CTC</label>
              </div>
              <div class="form-check">
                <input class="form-check-input" type="radio" name="company_pay_type" id="perDaysTypeRadio" value="Pay as per days">
                <label class="form-check-label" for="perDaysTypeRadio">Pay as per days</label>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Flat Amount Field -->
      <div class="row" id="flatAmountField" style="display: none;">
        <div class="col-md-6">
          <div class="mb-3">
            <label class="form-label">Flat Amount <span class="text-danger">*</span></label>
            <input type="text" name="flat_amount" class="form-control">
          </div>
        </div>
      </div>
      
      <!-- Percentage of CTC Field -->
      <div class="row" id="percentageCtcField" style="display: none;">
        <div class="col-md-6">
          <div class="mb-3">
            <label class="form-label">Percentage of CTC <span class="text-danger">*</span></label>
            <input type="number" name="percentage_of_ctc" class="form-control" min="0" max="100" step="0.01">
            <small class="text-muted">Enter percentage value (e.g., 10 for 10%)</small>
          </div>
        </div>
      </div>
      
      <!-- Pay per Days Field -->
      <div class="row" id="payPerDaysField" style="display: none;">
        <div class="col-md-6">
          <div class="mb-3">
            <label class="form-label">Number of Days <span class="text-danger">*</span></label>
            <input type="number" name="pay_per_days" class="form-control" min="1">
          </div>
        </div>
      </div>
    </div>
    
    <!-- Salary Deduction Fields -->
    <div class="row" id="salaryDeductionFields" style="display: none;">
      <div class="col-md-6">
        <div class="mb-3">
          <label class="form-label">Salary Transfer Date <span class="text-danger">*</span></label>
          <input type="date" name="salary_transfer_date" class="form-control">
        </div>
      </div>
      <div class="col-md-6">
        <div class="mb-3">
          <label class="form-label">Expected Payment Date <span class="text-danger">*</span></label>
          <input type="date" name="expected_payment_date" class="form-control">
        </div>
      </div>
    </div>
    
    <!-- SPDC/Candidate Pay Fields -->
    <div class="row" id="spdcFields" style="display: none;">
      <div class="col-md-6">
        <div class="mb-3">
          <label class="form-label">Salary Transfer Date <span class="text-danger">*</span></label>
          <input type="date" name="candidate_salary_transfer_date" class="form-control">
        </div>
      </div>
    </div>
  </div>
</div>

        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          <button type="submit" class="btn btn-primary">Add Vacancy</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- View/Edit/Delete Vacancy Modals -->
{% for vacancy in company.vacancies.all %}
<!-- View Vacancy Modal -->
<div class="modal fade" id="viewVacancyModal{{ vacancy.id }}" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header bg-gradient-primary text-white">
        <h5 class="modal-title">
          <i class="fas fa-briefcase me-2"></i>Vacancy Details: {{ vacancy.job_profile }}
          <span class="badge bg-white text-primary ms-2">{{ vacancy.company_vacancy_unique_code }}</span>
        </h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <!-- Basic Information Card -->
        <div class="card mb-4 border-0 shadow-sm">
          <div class="card-header bg-light-primary d-flex justify-content-between align-items-center">
            <h6 class="mb-0 text-primary">
              <i class="fas fa-info-circle me-2"></i>Basic Information
            </h6>
            <span class="badge text-white {% if vacancy.vacancy_status == 'Active' %}bg-success{% elif vacancy.vacancy_status == 'Closed' %}bg-danger{% else %}bg-warning{% endif %}">
              {{ vacancy.vacancy_status }}
            </span>
          </div>
          <div class="card-body">
            <div class="row">
              <div class="col-md-6">
                <div class="info-item mb-3">
                  <span class="info-label"><i class="fas fa-building me-2 text-muted"></i>Department:</span>
                  <span class="info-value">{{ vacancy.department_name }}</span>
                </div>
                <div class="info-item mb-3">
                  <span class="info-label"><i class="fas fa-industry me-2 text-muted"></i>Sector:</span>
                  <span class="info-value">{{ vacancy.sector_type }}</span>
                </div>
                <div class="info-item mb-3">
                  <span class="info-label"><i class="fas fa-user-tie me-2 text-muted"></i>Payroll:</span>
                  <span class="info-value">{{ vacancy.payroll }}</span>
                </div>
              </div>
              <div class="col-md-6">
                <div class="info-item mb-3">
                  <span class="info-label"><i class="fas fa-calendar-plus me-2 text-muted"></i>Opening Date:</span>
                  <span class="info-value">{{ vacancy.vacancy_opening_date|date:"d M Y" }}</span>
                </div>
                <div class="info-item mb-3">
                  <span class="info-label"><i class="fas fa-calendar-times me-2 text-muted"></i>Closing Date:</span>
                  <span class="info-value">{{ vacancy.vacancy_closing_date|date:"d M Y"|default:"-" }}</span>
                </div>
                <div class="info-item mb-3">
                  <span class="info-label"><i class="fas fa-user-clock me-2 text-muted"></i>Fresher Status:</span>
                  <span class="info-value">{{ vacancy.fresher_status }}</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Salary and Experience Card -->
        <div class="card mb-4 border-0 shadow-sm">
          <div class="card-header bg-light-primary">
            <h6 class="mb-0 text-primary">
              <i class="fas fa-money-bill-wave me-2"></i>Salary & Experience
            </h6>
          </div>
          <div class="card-body">
            <div class="row">
              <div class="col-md-6">
                <div class="info-item mb-3">
                  <span class="info-label"><i class="fas fa-rupee-sign me-2 text-muted"></i>Salary Range:</span>
                  <span class="info-value">₹{{ vacancy.minimum_salary_range }} - ₹{{ vacancy.maximum_salary_range }}</span>
                </div>
                <div class="info-item mb-3">
                  <span class="info-label"><i class="fas fa-graduation-cap me-2 text-muted"></i>Education:</span>
                  <span class="info-value">
                    {{ vacancy.minimum_education_qualification }}
                    {% if vacancy.specialization %}({{ vacancy.specialization }}){% endif %}
                  </span>
                </div>
              </div>
              <div class="col-md-6">
                <div class="info-item mb-3">
                  <span class="info-label"><i class="fas fa-briefcase me-2 text-muted"></i>Experience:</span>
                  <span class="info-value">
                    {{ vacancy.minimum_experience|default:"0" }} - {{ vacancy.maximum_experience }} years
                  </span>
                </div>
                <div class="info-item mb-3">
                  <span class="info-label"><i class="fas fa-venus-mars me-2 text-muted"></i>Gender:</span>
                  <span class="info-value">{{ vacancy.gender }}</span>
                </div>
              </div>
            </div>
            <div class="row">
              <div class="col-md-6">
                <div class="info-item mb-3">
                  <span class="info-label"><i class="fas fa-birthday-cake me-2 text-muted"></i>Age Range:</span>
                  <span class="info-value">
                    {{ vacancy.minimum_age|default:"-" }} - {{ vacancy.maximum_age|default:"-" }} years
                  </span>
                </div>
              </div>
              <div class="col-md-6">
                <div class="info-item mb-3">
                  <span class="info-label"><i class="fas fa-gift me-2 text-muted"></i>Incentive:</span>
                  <span class="info-value">
                    {{ vacancy.status_of_incentive }}
                  </span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Payment Details Card -->
        <div class="card mb-4 border-0 shadow-sm">
          <div class="card-header bg-light-primary">
            <h6 class="mb-0 text-primary">
              <i class="fas fa-credit-card me-2"></i>Payment Details
            </h6>
          </div>
          <div class="card-body">
            <div class="row">
              <div class="col-md-12">
                <div class="info-item mb-3">
                  <span class="info-label"><i class="fas fa-money-check-alt me-2 text-muted"></i>Payment Mode:</span>
                  <span class="info-value">
                    {% if vacancy.payment_mode %}
                      <span class="badge bg-primary text-white">{{ vacancy.payment_mode }}</span>
                    {% else %}
                      Not specified
                    {% endif %}
                  </span>
                </div>
                
                {% if vacancy.payment_mode == 'Company Pay' %}
                  <div class="info-item mb-3">
                    <span class="info-label"><i class="fas fa-tag me-2 text-muted"></i>Payment Type:</span>
                    <span class="info-value">{{ vacancy.company_pay_type }}</span>
                  </div>
                  
                  {% if vacancy.company_pay_type == 'Flat' %}
                    <div class="info-item mb-3">
                      <span class="info-label"><i class="fas fa-rupee-sign me-2 text-muted"></i>Flat Amount:</span>
                      <span class="info-value">₹{{ vacancy.flat_amount | default:'not decided' }}</span>
                    </div>
                  {% elif vacancy.company_pay_type == 'Percentage of CTC' %}
                    <div class="info-item mb-3">
                      <span class="info-label"><i class="fas fa-percent me-2 text-muted"></i>Percentage of CTC:</span>
                      <span class="info-value">{{ vacancy.percentage_of_ctc }}%</span>
                    </div>
                  {% elif vacancy.company_pay_type == 'Pay as per days' %}
                    <div class="info-item mb-3">
                      <span class="info-label"><i class="fas fa-calendar-day me-2 text-muted"></i>Pay per Days:</span>
                      <span class="info-value">{{ vacancy.pay_per_days }} days</span>
                    </div>
                  {% endif %}
                {% endif %}
              </div>
              
              <div class="col-md-6">
                {% if vacancy.payment_mode == 'Salary Deduction' %}
                  <div class="info-item mb-3">
                    <span class="info-label"><i class="fas fa-calendar-check me-2 text-muted"></i>Salary Transfer Date:</span>
                    <span class="info-value">{{ vacancy.salary_transfer_date|date:"d M Y"|default:"-" }}</span>
                  </div>
                  <div class="info-item mb-3">
                    <span class="info-label"><i class="fas fa-calendar-alt me-2 text-muted"></i>Expected Payment Date:</span>
                    <span class="info-value">{{ vacancy.expected_payment_date|date:"d M Y"|default:"-" }}</span>
                  </div>
                {% elif vacancy.payment_mode == 'SPDC/Candidate Pay' %}
                  <div class="info-item mb-3">
                    <span class="info-label"><i class="fas fa-calendar-check me-2 text-muted"></i>Salary Transfer Date:</span>
                    <span class="info-value">{{ vacancy.candidate_salary_transfer_date|date:"d M Y"|default:"-" }}</span>
                  </div>
                {% endif %}
              </div>
            </div>
          </div>
        </div>

        <!-- Additional Information Card -->
        <div class="card mb-3 border-0 shadow-sm">
          <div class="card-header bg-light-primary">
            <h6 class="mb-0 text-primary">
              <i class="fas fa-clipboard-list me-2"></i>Additional Information
            </h6>
          </div>
          <div class="card-body">
            <div class="mb-3">
              <h6 class="d-flex align-items-center mb-3">
                <i class="fas fa-exclamation-circle me-2 text-primary"></i>
                <strong>Special Instructions</strong>
              </h6>
              <div class="p-3 rounded">
                {{ vacancy.special_instruction|default:"No special instructions provided"|linebreaks }}
              </div>
            </div>
            
            {% if vacancy.company_usp %}
            <div class="mb-3">
              <h6 class="d-flex align-items-center mb-2">
                <i class="fas fa-star me-2 text-primary"></i>
                <strong>Company USP</strong>
              </h6>
              <p class="ps-4">{{ vacancy.company_usp }}</p>
            </div>
            {% endif %}
            
            {% if vacancy.replacement_criteria %}
            <div class="mb-3">
              <h6 class="d-flex align-items-center mb-2">
                <i class="fas fa-exchange-alt me-2 text-primary"></i>
                <strong>Replacement Criteria</strong>
              </h6>
              <p class="ps-4">{{ vacancy.replacement_criteria|linebreaks }}</p>
            </div>
            {% endif %}
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">
          <i class="fas fa-times me-1"></i> Close
        </button>
        <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#editVacancyModal{{ vacancy.id }}" data-bs-dismiss="modal">
          <i class="fas fa-edit me-1"></i> Edit
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Edit Vacancy Modal -->
<div class="modal fade" id="editVacancyModal{{ vacancy.id }}" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <form method="post" action="{% url 'admin_company_profile' company.id %}">
        {% csrf_token %}
        <input type="hidden" name="vacancy_id" value="{{ vacancy.id }}">
        <div class="modal-header">
          <h5 class="modal-title">Edit Vacancy</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="row">
            <div class="col-md-6 mb-3">
              <label class="form-label">Job Profile</label>
              <input type="text" class="form-control" name="job_profile" value="{{ vacancy.job_profile }}" required>
            </div>
            <div class="col-md-6 mb-3">
              <label class="form-label">Vacancy Code</label>
              <input type="text" class="form-control" name="company_vacancy_unique_code" value="{{ vacancy.company_vacancy_unique_code }}" required>
            </div>
          </div>
          
          <div class="row">
            <div class="col-md-6 mb-3">
              <label class="form-label">Payroll</label>
              <input type="text" class="form-control" name="payroll" value="{{ vacancy.payroll }}">
            </div>
            <div class="col-md-6 mb-3">
              <label class="form-label">Status</label>
              <select class="form-select" name="vacancy_status">
                <option value="Active" {% if vacancy.vacancy_status == 'Active' %}selected{% endif %}>Active</option>
                <option value="Pending" {% if vacancy.vacancy_status == 'Pending' %}selected{% endif %}>Pending</option>
                <option value="Closed" {% if vacancy.vacancy_status == 'Closed' %}selected{% endif %}>Closed</option>
              </select>
            </div>
          </div>
          
          <div class="row">
            <div class="col-md-6 mb-3">
              <label class="form-label">Opening Date</label>
              <input type="date" class="form-control" name="vacancy_opening_date" value="{{ vacancy.vacancy_opening_date|date:'Y-m-d' }}">
            </div>
            <div class="col-md-6 mb-3">
              <label class="form-label">Closing Date</label>
              <input type="date" class="form-control" name="vacancy_closing_date" value="{{ vacancy.vacancy_closing_date|date:'Y-m-d'|default:'' }}">
            </div>
          </div>
          
          <div class="row">
            <div class="col-md-6 mb-3">
              <label class="form-label">Sector Type</label>
              <select class="form-select" name="sector_type">
                {% for sector in job_sectors %}
                <option value="{{ sector }}" {% if vacancy.sector_type == sector %}selected{% endif %}>{{ sector }}</option>
                {% endfor %}
              </select>
            </div>
            <div class="col-md-6 mb-3">
              <label class="form-label">Department</label>
              <select class="form-select" name="department_name">
                {% for dept in departments %}
                <option value="{{ dept }}" {% if vacancy.department_name == dept %}selected{% endif %}>{{ dept }}</option>
                {% endfor %}
              </select>
            </div>
          </div>
          
          <div class="row">
            <div class="col-md-6 mb-3">
              <label class="form-label">Minimum Salary</label>
              <input type="number" class="form-control" name="minimum_salary_range" value="{{ vacancy.minimum_salary_range }}" step="0.1">
            </div>
            <div class="col-md-6 mb-3">
              <label class="form-label">Maximum Salary</label>
              <input type="number" class="form-control" name="maximum_salary_range" value="{{ vacancy.maximum_salary_range }}" step="0.1">
            </div>
          </div>
          
          <div class="row">
            <div class="col-md-6 mb-3">
              <label class="form-label">Minimum Experience (years)</label>
              <input type="number" class="form-control" name="minimum_experience" value="{{ vacancy.minimum_experience }}" step="0.1">
            </div>
            <div class="col-md-6 mb-3">
              <label class="form-label">Maximum Experience (years)</label>
              <input type="number" class="form-control" name="maximum_experience" value="{{ vacancy.maximum_experience }}" step="0.1">
            </div>
          </div>
          
          <div class="mb-3">
            <label class="form-label">Special Instructions</label>
            <textarea class="form-control" name="special_instruction" rows="3">{{ vacancy.special_instruction }}</textarea>
          </div>
          
          <!-- Payment Section -->
<div class="card mt-4">
  <div class="card-header bg-primary text-white">
    <h5 class="mb-0">Payment Details</h5>
  </div>
  <div class="card-body">
    <div class="row">
      <div class="col-md-12">
        <div class="mb-3">
          <label class="form-label">Payment Mode <span class="text-danger">*</span></label>
          <div class="d-flex flex-wrap gap-3">
            <div class="form-check">
              <input class="form-check-input" type="radio" name="payment_mode" id="companyPayRadioEdit{{ vacancy.id }}" 
                     value="Company Pay" {% if vacancy.payment_mode == 'Company Pay' %}checked{% endif %} required>
              <label class="form-check-label" for="companyPayRadioEdit{{ vacancy.id }}">Company Pay</label>
            </div>
            <div class="form-check">
              <input class="form-check-input" type="radio" name="payment_mode" id="salaryDeductionRadioEdit{{ vacancy.id }}" 
                     value="Salary Deduction" {% if vacancy.payment_mode == 'Salary Deduction' %}checked{% endif %}>
              <label class="form-check-label" for="salaryDeductionRadioEdit{{ vacancy.id }}">Salary Deduction</label>
            </div>
            <div class="form-check">
              <input class="form-check-input" type="radio" name="payment_mode" id="spdcPayRadioEdit{{ vacancy.id }}" 
                     value="SPDC/Candidate Pay" {% if vacancy.payment_mode == 'SPDC/Candidate Pay' %}checked{% endif %}>
              <label class="form-check-label" for="spdcPayRadioEdit{{ vacancy.id }}">SPDC/Candidate Pay</label>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Company Pay Fields -->
    <div id="companyPayFieldsEdit{{ vacancy.id }}" style="display: {% if vacancy.payment_mode == 'Company Pay' %}block{% else %}none{% endif %};">
      <div class="row">
        <div class="col-md-12">
          <div class="mb-3">
            <label class="form-label">Payment Type <span class="text-danger">*</span></label>
            <div class="d-flex flex-wrap gap-3">
              <div class="form-check">
                <input class="form-check-input" type="radio" name="company_pay_type" id="flatTypeRadioEdit{{ vacancy.id }}" 
                       value="Flat" {% if vacancy.company_pay_type == 'Flat' %}checked{% endif %}>
                <label class="form-check-label" for="flatTypeRadioEdit{{ vacancy.id }}">Flat</label>
              </div>
              <div class="form-check">
                <input class="form-check-input" type="radio" name="company_pay_type" id="percentageTypeRadioEdit{{ vacancy.id }}" 
                       value="Percentage of CTC" {% if vacancy.company_pay_type == 'Percentage of CTC' %}checked{% endif %}>
                <label class="form-check-label" for="percentageTypeRadioEdit{{ vacancy.id }}">% of CTC</label>
              </div>
              <div class="form-check">
                <input class="form-check-input" type="radio" name="company_pay_type" id="perDaysTypeRadioEdit{{ vacancy.id }}" 
                       value="Pay as per days" {% if vacancy.company_pay_type == 'Pay as per days' %}checked{% endif %}>
                <label class="form-check-label" for="perDaysTypeRadioEdit{{ vacancy.id }}">Pay as per days</label>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Flat Amount Field -->
      <div class="row" id="flatAmountFieldEdit{{ vacancy.id }}" style="display: {% if vacancy.company_pay_type == 'Flat' %}block{% else %}none{% endif %};">
        <div class="col-md-6">
          <div class="mb-3">
            <label class="form-label">Flat Amount <span class="text-danger">*</span></label>
            <input type="text" name="flat_amount" class="form-control" value="{{ vacancy.flat_amount|default:'' }}" 
                   {% if vacancy.company_pay_type == 'Flat' %}required{% endif %}>
          </div>
        </div>
      </div>
      
      <!-- Percentage of CTC Field -->
      <div class="row" id="percentageCtcFieldEdit{{ vacancy.id }}" style="display: {% if vacancy.company_pay_type == 'Percentage of CTC' %}block{% else %}none{% endif %};">
        <div class="col-md-6">
          <div class="mb-3">
            <label class="form-label">Percentage of CTC <span class="text-danger">*</span></label>
            <input type="number" name="percentage_of_ctc" class="form-control" min="0" max="100" step="0.01" 
                   value="{{ vacancy.percentage_of_ctc|default:'' }}" >
            <small class="text-muted">Enter percentage value (e.g., 10 for 10%)</small>
          </div>
        </div>
      </div>
      
      <!-- Pay per Days Field -->
      <div class="row" id="payPerDaysFieldEdit{{ vacancy.id }}" style="display: {% if vacancy.company_pay_type == 'Pay as per days' %}block{% else %}none{% endif %};">
        <div class="col-md-6">
          <div class="mb-3">
            <label class="form-label">Number of Days <span class="text-danger">*</span></label>
            <input type="number" name="pay_per_days" class="form-control" min="1" 
                   value="{{ vacancy.pay_per_days|default:'' }}" >
          </div>
        </div>
      </div>
    </div>
    
    <!-- Salary Deduction Fields -->
    <div class="row" id="salaryDeductionFieldsEdit{{ vacancy.id }}" style="display: {% if vacancy.payment_mode == 'Salary Deduction' %}block{% else %}none{% endif %};">
      <div class="col-md-6">
        <div class="mb-3">
          <label class="form-label">Salary Transfer Date <span class="text-danger">*</span></label>
          <input type="date" name="salary_transfer_date" class="form-control" 
                 value="{{ vacancy.salary_transfer_date|date:'Y-m-d'|default:'' }}" >
        </div>
      </div>
      <div class="col-md-6">
        <div class="mb-3">
          <label class="form-label">Expected Payment Date <span class="text-danger">*</span></label>
          <input type="date" name="expected_payment_date" class="form-control" 
                 value="{{ vacancy.expected_payment_date|date:'Y-m-d'|default:'' }}" >
        </div>
      </div>
    </div>
    
    <!-- SPDC/Candidate Pay Fields -->
    <div class="row" id="spdcFieldsEdit{{ vacancy.id }}" style="display: {% if vacancy.payment_mode == 'SPDC/Candidate Pay' %}block{% else %}none{% endif %};">
      <div class="col-md-6">
        <div class="mb-3">
          <label class="form-label">Salary Transfer Date <span class="text-danger">*</span></label>
          <input type="date" name="candidate_salary_transfer_date" class="form-control" 
                 value="{{ vacancy.candidate_salary_transfer_date|date:'Y-m-d'|default:'' }}" >
        </div>
      </div>
    </div>
  </div>
</div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          <button type="submit" class="btn btn-primary" name="edit_vacancy">Save changes</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Delete Vacancy Modal -->
<div class="modal fade" id="deleteVacancyModal{{ vacancy.id }}" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <form method="post" action="{% url 'admin_company_profile' company.id %}">
        {% csrf_token %}
        <input type="hidden" name="vacancy_id" value="{{ vacancy.id }}">
        <div class="modal-header">
          <h5 class="modal-title">Confirm Delete</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <p>Are you sure you want to delete the vacancy for <strong>{{ vacancy.job_profile }}</strong> ({{ vacancy.company_vacancy_unique_code }})?</p>
          <p class="text-danger">This action cannot be undone.</p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="submit" class="btn btn-danger" name="delete_vacancy">Delete Vacancy</button>
        </div>
      </form>
    </div>
  </div>
</div>
{% endfor %}

<script>
document.addEventListener("DOMContentLoaded", function () {
  // Payroll selection handler
  const payrollSelect = document.getElementById("payrollSelect");
  const thirdPartyInput = document.getElementById("thirdPartyInput");
  
  function toggleThirdPartyInput() {
    if (payrollSelect.value === "Third Party") {
      thirdPartyInput.style.display = "block";
      document.querySelector('[name="third_party_name"]').setAttribute('required', '');
    } else {
      thirdPartyInput.style.display = "none";
      document.querySelector('[name="third_party_name"]').removeAttribute('required');
    }
  }
  
  toggleThirdPartyInput();
  payrollSelect.addEventListener("change", toggleThirdPartyInput);
  
  // Vacancy form validation
  const vacancyForm = document.getElementById("vacancyForm");
  if (vacancyForm) {
    vacancyForm.addEventListener("submit", function(event) {
      const openingDate = document.querySelector('[name="vacancy_opening_date"]');
      const closingDate = document.querySelector('[name="vacancy_closing_date"]');
      
      if (closingDate.value && openingDate.value > closingDate.value) {
        closingDate.setCustomValidity("Closing date must be after opening date");
        closingDate.classList.add('is-invalid');
        event.preventDefault();
        event.stopPropagation();
      } else {
        closingDate.setCustomValidity("");
      }
      
      const minAge = document.querySelector('[name="minimum_age"]');
      const maxAge = document.querySelector('[name="maximum_age"]');
      
      if (minAge.value && maxAge.value && parseInt(minAge.value) > parseInt(maxAge.value)) {
        maxAge.setCustomValidity("Maximum age must be greater than minimum age");
        maxAge.classList.add('is-invalid');
        event.preventDefault();
        event.stopPropagation();
      } else {
        maxAge.setCustomValidity("");
      }
      
      const minExp = document.querySelector('[name="minimum_experience"]');
      const maxExp = document.querySelector('[name="maximum_experience"]');
      
      if (minExp.value && maxExp.value && parseInt(minExp.value) > parseInt(maxExp.value)) {
        maxExp.setCustomValidity("Maximum experience must be greater than minimum experience");
        maxExp.classList.add('is-invalid');
        event.preventDefault();
        event.stopPropagation();
      } else {
        maxExp.setCustomValidity("");
      }
      
      const minSalary = document.querySelector('[name="minimum_salary_range"]');
      const maxSalary = document.querySelector('[name="maximum_salary_range"]');
      
      if (minSalary.value && maxSalary.value && parseInt(minSalary.value) > parseInt(maxSalary.value)) {
        maxSalary.setCustomValidity("Maximum salary must be greater than minimum salary");
        maxSalary.classList.add('is-invalid');
        event.preventDefault();
        event.stopPropagation();
      } else {
        maxSalary.setCustomValidity("");
      }
    });
  }
  
  // Payment mode selection handler for add vacancy
  const paymentModeSelect = document.getElementById("paymentModeSelect");
  const companyPayFields = document.getElementById("companyPayFields");
  const salaryDeductionFields = document.getElementById("salaryDeductionFields");
  const spdcFields = document.getElementById("spdcFields");
  
  if (paymentModeSelect) {
    paymentModeSelect.addEventListener("change", function() {
      // Hide all fields first
      companyPayFields.style.display = "none";
      salaryDeductionFields.style.display = "none";
      spdcFields.style.display = "none";
      
      // Reset company pay type fields
      document.getElementById("companyPayTypeSelect").value = "";
      document.getElementById("flatAmountField").style.display = "none";
      document.getElementById("percentageCtcField").style.display = "none";
      document.getElementById("payPerDaysField").style.display = "none";
      
      // Show relevant fields based on selection
      if (this.value === "Company Pay") {
        companyPayFields.style.display = "block";
      } else if (this.value === "Salary Deduction") {
        salaryDeductionFields.style.display = "block";
      } else if (this.value === "SPDC/Candidate Pay") {
        spdcFields.style.display = "block";
      }
    });
  }
  
  // Company pay type selection handler for add vacancy
  const companyPayTypeSelect = document.getElementById("companyPayTypeSelect");
  if (companyPayTypeSelect) {
    companyPayTypeSelect.addEventListener("change", function() {
      // Hide all fields first
      document.getElementById("flatAmountField").style.display = "none";
      document.getElementById("percentageCtcField").style.display = "none";
      document.getElementById("payPerDaysField").style.display = "none";
      
      // Show relevant field based on selection
      if (this.value === "Flat") {
        document.getElementById("flatAmountField").style.display = "block";
      } else if (this.value === "Percentage of CTC") {
        document.getElementById("percentageCtcField").style.display = "block";
      } else if (this.value === "Pay as per days") {
        document.getElementById("payPerDaysField").style.display = "block";
      }
    });
  }
  
  // Initialize all forms validation
  initFormValidation('profileForm');
  initFormValidation('companyDetailsForm');
  initFormValidation('callingRemarkForm');
  
  // Add real-time validation for all input fields
  addRealTimeValidation();
});

// Form validation functions
function initFormValidation(formId) {
  const form = document.getElementById(formId);
  if (!form) return;

  form.addEventListener('submit', function(event) {
    if (!form.checkValidity()) {
      event.preventDefault();
      event.stopPropagation();
    }
    form.classList.add('was-validated');
  });

  // Add input event listeners for real-time validation
  const inputs = form.querySelectorAll('input, select, textarea');
  inputs.forEach(input => {
    input.addEventListener('input', function() {
      validateField(this);
    });
    input.addEventListener('blur', function() {
      validateField(this);
    });
  });
}

function addRealTimeValidation() {
  // Employee Name validation
  const employeeNameInput = document.querySelector('input[name="employee_name"]');
  if (employeeNameInput) {
    employeeNameInput.addEventListener('input', function() {
      validateNameField(this, 'Employee name');
    });
  }

  // Company Name validation
  const companyNameInput = document.querySelector('input[name="company_name"]');
  if (companyNameInput) {
    companyNameInput.addEventListener('input', function() {
      validateRequiredField(this, 'Company name');
    });
  }

  // Company Logo validation
  const companyLogoInput = document.querySelector('input[name="company_logo"]');
  if (companyLogoInput) {
    companyLogoInput.addEventListener('change', function() {
      validateImageFile(this);
    });
  }

  // Company Location validation
  const companyLocationInput = document.querySelector('input[name="company_location"]');
  if (companyLocationInput) {
    companyLocationInput.addEventListener('input', function() {
      validateRequiredField(this, 'Company location');
    });
  }

  // Company Unique Code validation
  const companyUniqueCodeInput = document.querySelector('input[name="company_unique_code"]');
  if (companyUniqueCodeInput) {
    companyUniqueCodeInput.addEventListener('input', function() {
      validateAlphanumericField(this, 'Company unique code');
    });
  }

  // Email validation
  const emailInput = document.querySelector('input[name="company_email_address"]');
  if (emailInput) {
    emailInput.addEventListener('input', function() {
      validateEmailField(this);
    });
  }

  // Contact Person Name validation
  const contactPersonNameInput = document.querySelector('input[name="company_contact_person_name"]');
  if (contactPersonNameInput) {
    contactPersonNameInput.addEventListener('input', function() {
      validateNameField(this, 'Contact person name');
    });
  }

  // Contact Person Contact Details validation
  const contactDetailsInput = document.querySelector('input[name="company_contact_person_contact_details"]');
  if (contactDetailsInput) {
    contactDetailsInput.addEventListener('input', function() {
      validatePhoneField(this);
    });
  }

  // Interview Address validation
  const interviewAddressInput = document.querySelector('input[name="interview_address"]');
  if (interviewAddressInput) {
    interviewAddressInput.addEventListener('input', function() {
      validateRequiredField(this, 'Interview address');
    });
  }

  // Status of Proposal validation
  const statusProposalSelect = document.querySelector('select[name="status_of_proposal"]');
  if (statusProposalSelect) {
    statusProposalSelect.addEventListener('change', function() {
      validateSelectField(this, 'Status of proposal');
    });
  }

  // Date fields validation
  const dateFields = document.querySelectorAll('input[type="date"]');
  dateFields.forEach(field => {
    field.addEventListener('change', function() {
      validateDateField(this);
    });
  });

  // Payment Condition validation
  const paymentConditionSelect = document.querySelector('select[name="payment_condiation"]');
  if (paymentConditionSelect) {
    paymentConditionSelect.addEventListener('change', function() {
      validateSelectField(this, 'Payment condition');
    });
  }

  // Remark validation
  const remarkTextarea = document.querySelector('textarea[name="remark"]');
  if (remarkTextarea) {
    remarkTextarea.addEventListener('input', function() {
      validateTextField(this, 'Remark', 500);
    });
  }
}

// Field-specific validation functions
function validateField(field) {
  if (field.type === 'file') {
    validateImageFile(field);
  } else if (field.type === 'email') {
    validateEmailField(field);
  } else if (field.type === 'date') {
    validateDateField(field);
  } else if (field.tagName === 'SELECT') {
    validateSelectField(field);
  } else if (field.tagName === 'TEXTAREA') {
    validateTextField(field, field.name, field.maxLength);
  } else if (field.hasAttribute('pattern')) {
    if (field.name.includes('name')) {
      validateNameField(field);
    } else if (field.name.includes('contact_details')) {
      validatePhoneField(field);
    } else if (field.name.includes('unique_code')) {
      validateAlphanumericField(field);
    }
  } else {
    validateRequiredField(field);
  }
}

function validateNameField(field, fieldName = 'Name') {
  const value = field.value.trim();
  const isValid = /^[a-zA-Z\s.]*$/.test(value) && value.length >= 2 && value.length <= 100;
  
  if (!isValid) {
    field.setCustomValidity(`${fieldName} must be 2-100 characters with only alphabets, spaces and dots.`);
  } else {
    field.setCustomValidity('');
  }
  updateFieldStatus(field, isValid);
}

function validateRequiredField(field, fieldName = 'This field') {
  const value = field.value.trim();
  const minLength = field.getAttribute('minlength') || 0;
  const maxLength = field.getAttribute('maxlength') || Infinity;
  const isValid = value.length >= minLength && value.length <= maxLength;
  
  if (!isValid) {
    field.setCustomValidity(`${fieldName} is required and must be between ${minLength} and ${maxLength} characters.`);
  } else {
    field.setCustomValidity('');
  }
  updateFieldStatus(field, isValid);
}

function validateEmailField(field) {
  const value = field.value.trim();
  if (!value) {
    field.setCustomValidity('');
    updateFieldStatus(field, true);
    return;
  }
  
  const isValid = /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(value) && value.length <= 100;
  if (!isValid) {
    field.setCustomValidity('Please enter a valid email address (e.g., example@domain.com).');
  } else {
    field.setCustomValidity('');
  }
  updateFieldStatus(field, isValid);
}

function validatePhoneField(field) {
  const value = field.value.trim();
  if (!value) {
    field.setCustomValidity('');
    updateFieldStatus(field, true);
    return;
  }
  
  const isValid = /^[0-9]{10}$/.test(value);
  if (!isValid) {
    field.setCustomValidity('Please enter a valid 10-digit phone number (numbers only).');
  } else {
    field.setCustomValidity('');
  }
  updateFieldStatus(field, isValid);
}

function validateAlphanumericField(field, fieldName = 'This field') {
  const value = field.value.trim();
  const isValid = /^[a-zA-Z0-9\-_]*$/.test(value) && value.length >= 3 && value.length <= 50;
  
  if (!isValid) {
    field.setCustomValidity(`${fieldName} must be 3-50 characters with only alphanumeric characters, hyphens and underscores.`);
  } else {
    field.setCustomValidity('');
  }
  updateFieldStatus(field, isValid);
}

function validateImageFile(field) {
  if (!field.files || field.files.length === 0) {
    field.setCustomValidity('');
    updateFieldStatus(field, true);
    return;
  }
  
  const file = field.files[0];
  const validTypes = ['image/jpeg', 'image/png', 'image/jpg'];
  const maxSize = 2 * 1024 * 1024; // 2MB
  
  const isValidType = validTypes.includes(file.type);
  const isValidSize = file.size <= maxSize;
  
  if (!isValidType) {
    field.setCustomValidity('Please upload a valid image file (PNG, JPG, JPEG only).');
  } else if (!isValidSize) {
    field.setCustomValidity('Image size must be less than 2MB.');
  } else {
    field.setCustomValidity('');
  }
  
  updateFieldStatus(field, isValidType && isValidSize);
}

function validateDateField(field) {
  const value = field.value;
  if (!value) {
    field.setCustomValidity('');
    updateFieldStatus(field, true);
    return;
  }
  
  const date = new Date(value);
  const isValid = !isNaN(date.getTime());
  
  if (!isValid) {
    field.setCustomValidity('Please enter a valid date (YYYY-MM-DD format).');
  } else {
    field.setCustomValidity('');
  }
  updateFieldStatus(field, isValid);
}

function validateSelectField(field, fieldName = 'This field') {
  const isValid = field.value !== '';
  
  if (!isValid) {
    field.setCustomValidity(`Please select a ${fieldName.toLowerCase()}.`);
  } else {
    field.setCustomValidity('');
  }
  updateFieldStatus(field, isValid);
}

function validateTextField(field, fieldName = 'This field', maxLength = 500) {
  const value = field.value.trim();
  const isValid = value.length <= maxLength;
  
  if (!isValid) {
    field.setCustomValidity(`${fieldName} must be less than ${maxLength} characters.`);
  } else {
    field.setCustomValidity('');
  }
  updateFieldStatus(field, isValid);
}

function updateFieldStatus(field, isValid) {
  if (isValid) {
    field.classList.remove('is-invalid');
    field.classList.add('is-valid');
  } else {
    field.classList.remove('is-valid');
    field.classList.add('is-invalid');
  }
  
  // Update feedback message immediately
  const feedback = field.nextElementSibling;
  if (feedback && feedback.classList.contains('invalid-feedback')) {
    feedback.textContent = field.validationMessage || feedback.dataset.originalMessage || 'Invalid value';
  }
}

// Initialize original messages for feedback elements
document.querySelectorAll('.invalid-feedback').forEach(feedback => {
  feedback.dataset.originalMessage = feedback.textContent;
});

// Edit vacancy modals payment mode handlers
document.querySelectorAll('[id^="paymentModeSelectEdit"]').forEach(function(paymentModeSelect) {
  const vacancyId = paymentModeSelect.id.replace('paymentModeSelectEdit', '');

  const companyPayFields = document.getElementById('companyPayFieldsEdit' + vacancyId);
  const salaryDeductionFields = document.getElementById('salaryDeductionFieldsEdit' + vacancyId);
  const spdcFields = document.getElementById('spdcFieldsEdit' + vacancyId);
  const companyPayTypeSelect = document.getElementById('companyPayTypeSelectEdit' + vacancyId);
  const flatAmountField = document.getElementById('flatAmountFieldEdit' + vacancyId);
  const percentageCtcField = document.getElementById('percentageCtcFieldEdit' + vacancyId);
  const payPerDaysField = document.getElementById('payPerDaysFieldEdit' + vacancyId);

  // Handle payment mode change
  paymentModeSelect.addEventListener('change', function() {
    companyPayFields.style.display = 'none';
    salaryDeductionFields.style.display = 'none';
    spdcFields.style.display = 'none';

    flatAmountField.style.display = 'none';
    percentageCtcField.style.display = 'none';
    payPerDaysField.style.display = 'none';

    companyPayTypeSelect.value = '';

    if (this.value === 'Company Pay') {
      companyPayFields.style.display = 'block';
    } else if (this.value === 'Salary Deduction') {
      salaryDeductionFields.style.display = 'block';
    } else if (this.value === 'SPDC/Candidate Pay') {
      spdcFields.style.display = 'block';
    }
  });

  // Handle company pay type change
  companyPayTypeSelect.addEventListener('change', function() {
    flatAmountField.style.display = 'none';
    percentageCtcField.style.display = 'none';
    payPerDaysField.style.display = 'none';

    if (this.value === 'Flat') {
      flatAmountField.style.display = 'block';
    } else if (this.value === 'Percentage of CTC') {
      percentageCtcField.style.display = 'block';
    } else if (this.value === 'Pay as per days') {
      payPerDaysField.style.display = 'block';
    }
  });

  // Set min dates on load
  const today = new Date().toISOString().split('T')[0];
  const salaryTransferDate = document.querySelector(`[name="salary_transfer_date"]`);
  const expectedPaymentDate = document.querySelector(`[name="expected_payment_date"]`);
  const candidateSalaryTransferDate = document.querySelector(`[name="candidate_salary_transfer_date"]`);

  if (salaryTransferDate) salaryTransferDate.min = today;
  if (expectedPaymentDate) expectedPaymentDate.min = today;
  if (candidateSalaryTransferDate) candidateSalaryTransferDate.min = today;
});
</script>

<script>

  // Payment mode selection handler for add vacancy
const paymentModeRadios = document.querySelectorAll('input[name="payment_mode"]');
const companyPayFields = document.getElementById("companyPayFields");
const salaryDeductionFields = document.getElementById("salaryDeductionFields");
const spdcFields = document.getElementById("spdcFields");

paymentModeRadios.forEach(radio => {
  radio.addEventListener("change", function() {
    // Hide all fields first
    companyPayFields.style.display = "none";
    salaryDeductionFields.style.display = "none";
    spdcFields.style.display = "none";
    
    // Reset company pay type fields
    document.querySelectorAll('input[name="company_pay_type"]').forEach(r => r.checked = false);
    document.getElementById("flatAmountField").style.display = "none";
    document.getElementById("percentageCtcField").style.display = "none";
    document.getElementById("payPerDaysField").style.display = "none";
    
    // Show relevant fields based on selection
    if (this.value === "Company Pay") {
      companyPayFields.style.display = "block";
    } else if (this.value === "Salary Deduction") {
      salaryDeductionFields.style.display = "block";
    } else if (this.value === "SPDC/Candidate Pay") {
      spdcFields.style.display = "block";
    }
  });
});

// Company pay type selection handler for add vacancy
const companyPayTypeRadios = document.querySelectorAll('input[name="company_pay_type"]');
companyPayTypeRadios.forEach(radio => {
  radio.addEventListener("change", function() {
    // Hide all fields first
    document.getElementById("flatAmountField").style.display = "none";
    document.getElementById("percentageCtcField").style.display = "none";
    document.getElementById("payPerDaysField").style.display = "none";
    
    // Show relevant field based on selection
    if (this.value === "Flat") {
      document.getElementById("flatAmountField").style.display = "block";
    } else if (this.value === "Percentage of CTC") {
      document.getElementById("percentageCtcField").style.display = "block";
    } else if (this.value === "Pay as per days") {
      document.getElementById("payPerDaysField").style.display = "block";
    }
  });
});

// Edit vacancy modals payment mode handlers
document.querySelectorAll('input[name^="payment_mode"]').forEach(function(radio) {
  if (radio.id.includes('Edit')) {
    const vacancyId = radio.id.replace(/companyPayRadioEdit|salaryDeductionRadioEdit|spdcPayRadioEdit/g, '');
    
    const companyPayFields = document.getElementById('companyPayFieldsEdit' + vacancyId);
    const salaryDeductionFields = document.getElementById('salaryDeductionFieldsEdit' + vacancyId);
    const spdcFields = document.getElementById('spdcFieldsEdit' + vacancyId);
    
    radio.addEventListener('change', function() {
      // Hide all fields first
      companyPayFields.style.display = 'none';
      salaryDeductionFields.style.display = 'none';
      spdcFields.style.display = 'none';
      
      // Reset company pay type fields
      document.querySelectorAll('input[name="company_pay_type"]').forEach(r => r.checked = false);
      document.getElementById('flatAmountFieldEdit' + vacancyId).style.display = 'none';
      document.getElementById('percentageCtcFieldEdit' + vacancyId).style.display = 'none';
      document.getElementById('payPerDaysFieldEdit' + vacancyId).style.display = 'none';
      
      // Show relevant fields based on selection
      if (this.value === 'Company Pay') {
        companyPayFields.style.display = 'block';
      } else if (this.value === 'Salary Deduction') {
        salaryDeductionFields.style.display = 'block';
      } else if (this.value === 'SPDC/Candidate Pay') {
        spdcFields.style.display = 'block';
      }
    });
  }
});

// Edit vacancy modals company pay type handlers
document.querySelectorAll('input[name^="company_pay_type"]').forEach(function(radio) {
  if (radio.id.includes('Edit')) {
    const vacancyId = radio.id.replace(/flatTypeRadioEdit|percentageTypeRadioEdit|perDaysTypeRadioEdit/g, '');
    
    radio.addEventListener('change', function() {
      // Hide all fields first
      document.getElementById('flatAmountFieldEdit' + vacancyId).style.display = 'none';
      document.getElementById('percentageCtcFieldEdit' + vacancyId).style.display = 'none';
      document.getElementById('payPerDaysFieldEdit' + vacancyId).style.display = 'none';
      
      // Show relevant field based on selection
      if (this.value === 'Flat') {
        document.getElementById('flatAmountFieldEdit' + vacancyId).style.display = 'block';
      } else if (this.value === 'Percentage of CTC') {
        document.getElementById('percentageCtcFieldEdit' + vacancyId).style.display = 'block';
      } else if (this.value === 'Pay as per days') {
        document.getElementById('payPerDaysFieldEdit' + vacancyId).style.display = 'block';
      }
    });
  }
});

// Set min dates on load
const today = new Date().toISOString().split('T')[0];
document.querySelectorAll('input[type="date"]').forEach(dateInput => {
  if (!dateInput.value) {
    dateInput.min = today;
  }
});
</script>

{% endblock content %}