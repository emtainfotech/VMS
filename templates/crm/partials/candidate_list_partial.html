<div class="bg-light border rounded p-3">
    <h5>All Activities by {{ employee.user.get_full_name|default:employee.user.username }}</h5>
    {% if activities %}
    <table class="table table-sm table-striped mt-3">
        <thead>
            <tr>
                <th>Candidate Name</th>
                <th>Activity Type</th>
                <th>Activity Time</th>
                <th>Historical Call Status</th>
                <th>Historical Lead Status</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody>
            {% for activity in activities %}
            <tr>
                <td>{{ activity.candidate.candidate_name }}</td>
                <td>
                    {% if activity.action == 'call_made' %}
                        <span class="badge bg-blue-lt">Call Made</span>
                    {% elif activity.action == 'created' %}
                        <span class="badge bg-green-lt">Created</span>
                    {% else %}
                         <span class="badge bg-secondary-lt">{{ activity.action }}</span>
                    {% endif %}
                </td>
                <td>{{ activity.timestamp|date:"M d, Y H:i" }}</td>
                <td>
                    {% with logged_status=activity.changes.call_connection.new %}
                        {% if activity.action == 'call_made' and logged_status is not None %}
                            {% if logged_status == 'Connected' %}
                                <span class="badge bg-success me-1"></span> Connected
                            {% else %}
                                <span class="badge bg-danger me-1"></span> {{ logged_status }}
                            {% endif %}
                        {% else %}
                             {% if activity.candidate.call_connection == 'Connected' %}
                                <span class="badge bg-success me-1"></span> Connected
                            {% elif activity.candidate.call_connection %}
                                <span class="badge bg-danger me-1"></span> {{ activity.candidate.call_connection }}
                            {% else %}
                                <span class="badge bg-secondary me-1"></span> N/A
                            {% endif %}
                        {% endif %}
                    {% endwith %}
                </td>
                <td>
                    {% with lead_status=activity.changes.lead_generate.new %}
                        {% if activity.action == 'call_made' and lead_status is not None %}
                            {% if lead_status == 'Hot' or lead_status == 'Converted' %}
                                <span class="badge bg-warning-lt">{{ lead_status }}</span>
                            {% else %}
                                {{ lead_status|default:'-' }}
                            {% endif %}
                        {% else %}
                            {{ activity.candidate.lead_generate|default:'-' }}
                        {% endif %}
                    {% endwith %}
                </td>
                <td>
                    <a href="{% url 'admin_candidate_profile' activity.candidate.id %}" class="btn btn-sm btn-outline-primary">View Profile</a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p class="text-muted mt-3">No activities found for this employee in the selected period.</p>
    {% endif %}
</div>