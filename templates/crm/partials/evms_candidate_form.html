<style>
        .sticky-section-header {
            position: sticky;
            top: -25px; /* Adjust based on your header height */
            background-color: white;
            z-index: 1000;
            padding: 10px 0;
            color: #000;
            font-size: 16px;
            font-weight: 600;
            border-bottom: 1px solid #eee;
            margin-top: 0;
            margin-bottom: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        /* Custom Dropdown Styles */
        .custom-dropdown {
            position: relative;
            width: 100%;
        }

        .dropdown-input-container {
            position: relative;
            display: flex;
        }

        .dropdown-search-input {
            padding-right: 35px;
        }

        .dropdown-toggle-btn {
            position: absolute;
            right: 0;
            top: 0;
            height: 100%;
            background: transparent;
            border: none;
            padding: 0 10px;
            color: #6c757d;
        }

        .dropdown-options {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            max-height: 250px;
            overflow-y: auto;
            border: 1px solid #ced4da;
            border-radius: 0.25rem;
            background: white;
            z-index: 1000;
            margin-top: 2px;
        }

        .dropdown-option {
            padding: 8px 12px;
            cursor: pointer;
        }

        .dropdown-option:hover {
            background-color: #f8f9fa;
        }

        .dropdown-option.active {
            background-color: #007bff;
            color: white;
        }
    </style>

<div class="modal modal-blur fade" id="unified-candidate-modal" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="modal-title">Candidate Information - {{ candidate.candidate_name }}({{ candidate.candidate_mobile_number }})</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>

            <ul class="nav nav-tabs nav-fill" id="formTabs" role="tablist">
                <li class="nav-item">
                    <a class="nav-link active" id="profile-tab" data-bs-toggle="tab" href="#profile" role="tab" aria-controls="profile" aria-selected="true">Profile</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="interviews-tab" data-bs-toggle="tab" href="#interviews" role="tab" aria-controls="interviews" aria-selected="false">Interviews</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="vendor-tab" data-bs-toggle="tab" href="#vendor" role="tab" aria-controls="vendor" aria-selected="false">Vendor Data</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="invoice-tab" data-bs-toggle="tab" href="#invoice" role="tab" aria-controls="invoice" aria-selected="false">Invoice Data</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="activities-tab" data-bs-toggle="tab" href="#activities" role="tab" aria-controls="activities" aria-selected="false">Activities</a>
                </li>
            </ul>

            <div class="modal-body" style="overflow-y: auto; max-height: calc(100vh - 200px);">
                <form method="POST" enctype="multipart/form-data" id="unifiedCandidateForm" novalidate>
                    {% csrf_token %}
                    <input type="hidden" name="submit_by" value="{{ user.username }}"/>
                    
                    <div class="tab-content" id="formTabContent">
                        <div class="tab-pane fade show active" id="profile" role="tabpanel" aria-labelledby="profile-tab">
                            <hr class="my-4">
                            <h5 class="text-secondary mb-4 sticky-section-header">Candidate Profile</h5>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Candidate Name <span class="text-danger">*</span></label>
                                    <input type="text" class="form-control" name="candidate_name" id="candidateName" value="{{ candidate.candidate_name }}"
                                           required pattern="[A-Za-z ]+" minlength="3" maxlength="50" />
                                    <div class="invalid-feedback">
                                        Please enter a valid name (3-50 characters, letters only)
                                    </div>
                                </div>
                                
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Candidate Mobile Number <span class="text-danger">*</span></label>
                                    <input type="tel" class="form-control" name="candidate_mobile_number" id="candidateMobile"
                                           value="{{ candidate.candidate_mobile_number }}" required pattern="[0-9]{10}" />
                                    <div class="invalid-feedback">
                                        Please enter a valid 10-digit mobile number
                                    </div>
                                </div>
                                
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Candidate Email Address <span class="text-danger">*</span></label>
                                    <input type="email" class="form-control" name="candidate_email_address" id="candidateEmail"
                                           value="{{ candidate.candidate_email_address }}" />
                                    <div class="invalid-feedback">
                                        Please enter a valid email address
                                    </div>
                                </div>

                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Gender <span class="text-danger">*</span></label>
                                    <select class="form-select" name="gender" required>
                                        <option value="" disabled>Select Gender</option>
                                        <option value="Male" {% if candidate.gender == "Male" %}selected{% endif %}>Male</option>
                                        <option value="Female" {% if candidate.gender == "Female" %}selected{% endif %}>Female</option>
                                        <option value="Other" {% if candidate.gender == "Other" %}selected{% endif %}>Other</option>
                                    </select>
                                    <div class="invalid-feedback">
                                        Please select a gender
                                    </div>
                                </div>
                                
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Candidate Image</label>
                                    <input type="file" class="form-control" name="candidate_photo"
                                           accept="image/*" />
                                    {% if candidate.candidate_photo %}
                                    <div class="mt-2">
                                        <small class="text-muted">Current file: <a href="{{ candidate.candidate_photo.url }}" target="_blank">View Photo</a>
                                            <div class="form-check form-check-inline ms-2">
                                                <input class="form-check-input" type="checkbox" name="candidate_photo-clear" id="candidatePhotoClear">
                                                <label class="form-check-label" for="candidatePhotoClear">Clear</label>
                                            </div>
                                        </small>
                                    </div>
                                    {% endif %}
                                    <div class="invalid-feedback">
                                        Please upload a valid image file (JPEG, PNG, etc.)
                                    </div>
                                    <small class="text-muted">Max size: 2MB</small>
                                </div>
                                
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Candidate Resume</label>
                                    <input type="file" class="form-control" name="candidate_resume"
                                           accept=".pdf,.doc,.docx" />
                                    {% if candidate.candidate_resume %}
                                    <div class="mt-2">
                                        <small class="text-muted">Current file: <a href="{{ candidate.candidate_resume.url }}" target="_blank">View Resume</a>
                                            <div class="form-check form-check-inline ms-2">
                                                <input class="form-check-input" type="checkbox" name="candidate_resume-clear" id="candidateResumeClear">
                                                <label class="form-check-label" for="candidateResumeClear">Clear</label>
                                            </div>
                                        </small>
                                    </div>
                                    {% endif %}
                                    <div class="invalid-feedback">
                                        Please upload a valid resume (PDF, DOC, DOCX)
                                    </div>
                                    <small class="text-muted">Max size: 5MB</small>
                                </div>
                                
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Lead Source</label>
                                    <select name="lead_source" class="form-select" required id="leadSourceSelect">
                                        <option value="" disabled selected>Select Lead Source</option>
                                        <option value="EVMS" {% if candidate.lead_source == "EVMS" %}selected{% endif %}>EVMS</option>
                                        <option value="Walk-In" {% if candidate.lead_source == "Walk-In" %}selected{% endif %}>Walk-In</option>
                                        <option value="Job Hai" {% if candidate.lead_source == "Job Hai" %}selected{% endif %}>Job Hai</option>
                                        <option value="Naukari" {% if candidate.lead_source == "Naukari" %}selected{% endif %}>Naukari</option>
                                        <option value="Apna" {% if candidate.lead_source == "Apna" %}selected{% endif %}>Apna</option>
                                        <option value="Expertia" {% if candidate.lead_source == "Expertia" %}selected{% endif %}>Expertia</option>
                                        <option value="Instagram" {% if candidate.lead_source == "Instagram" %}selected{% endif %}>Instagram</option>
                                        <option value="Website" {% if candidate.lead_source == "Website" %}selected{% endif %}>Website</option>
                                        <option value="Indeed" {% if candidate.lead_source == "Indeed" %}selected{% endif %}>Indeed</option>
                                        <option value="Facebook" {% if candidate.lead_source == "Facebook" %}selected{% endif %}>Facebook</option>
                                        <option value="Linkedin" {% if candidate.lead_source == "Linkedin" %}selected{% endif %}>Linkedin</option>
                                        <option value="Personal Refference" {% if candidate.lead_source == "Personal Refference" %}selected{% endif %}>Personal Refference</option>
                                        <option value="Other" {% if candidate.lead_source == "Other" %}selected{% endif %}>Other</option>
                                    </select>
                                    <div id="otherLeadSourceContainer" style="display: none;" class="mt-2">
                                        <label class="form-label">Specify Other Lead Source</label>
                                        <input type="text" class="form-control" name="other_lead_source"
                                               value="{{ candidate.other_lead_source }}" maxlength="100">
                                    </div>
                                </div>
                                
                                <div class="col-md-6 col-md-3">
                                    <div class="mb-3">
                                        <label class="form-label">Follow-Up By <span class="text-danger">*</span></label>
                                        <select class="form-select" name="employee_name" required>
                                            <option value="" disabled>Select Employee</option>
                                            {% for employee in employees %}
                                                <option value="{{ employee.first_name }} {{ employee.last_name }} ({{ employee.employee_id }})"
                                                        {% if candidate.employee_name == employee.first_name|add:" "|add:employee.last_name|add:" ("|add:employee.employee_id|add:")" %}selected{% endif %}>
                                                    {{ employee.first_name }} {{ employee.last_name }} ({{ employee.employee_id }})
                                                </option>
                                            {% endfor %}
                                        </select>
                                        <div class="invalid-feedback">
                                            Please select an employee for follow-up
                                        </div>
                                    </div>
                                </div>

                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Assign To</label>
                                    <select class="form-select" name="employee_assigned">
                                        <option value="" disabled>Select Employee</option>
                                        {% for employee in employees %}
                                            <option value="{{ employee.first_name }} {{ employee.last_name }} ({{ employee.employee_id }})"
                                                    {% if candidate.employee_assigned == employee.first_name|add:" "|add:employee.last_name|add:" ("|add:employee.employee_id|add:")" %}selected{% endif %}>
                                                {{ employee.first_name }} {{ employee.last_name }} ({{ employee.employee_id }})
                                            </option>
                                        {% endfor %}
                                    </select>
                                    <div class="invalid-feedback">
                                        Please select employee to assign
                                    </div>
                                </div>
                            </div>
                            <hr class="my-4">
                            <h5 class="text-secondary mb-4 sticky-section-header">Candidate Details</h5>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Alternate Mobile Number</label>
                                    <input type="tel" class="form-control" name="candidate_alternate_mobile_number"
                                           value="{{candidate.candidate_alternate_mobile_number}}"
                                           pattern="[0-9]{10}">
                                    <div class="invalid-feedback">
                                        Please enter a valid 10-digit mobile number
                                    </div>
                                </div>

                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Preferred State</label>
                                    <div class="dropdown">
                                        <button class="btn btn-outline-secondary dropdown-toggle w-100 text-start" type="button"
                                                id="stateDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                                            {% if candidate.preferred_state %}
                                                {% if candidate.preferred_state|length > 2 %}
                                                    {{ candidate.preferred_state|length }} states selected
                                                {% else %}
                                                    {{ candidate.preferred_state }}
                                                {% endif %}
                                            {% else %}
                                                Select states...
                                            {% endif %}
                                        </button>
                                        <ul class="dropdown-menu w-100 p-2" aria-labelledby="stateDropdown">
                                            <li>
                                                <div class="px-2 mb-2">
                                                    <input type="text" class="form-control search-input"
                                                           placeholder="Search states..."
                                                           id="stateSearch">
                                                </div>
                                            </li>
                                            <div class="dropdown-options" style="max-height: 250px; overflow-y: auto;">
                                                {% for S in state %}
                                                <li class="dropdown-item">
                                                    <div class="form-check">
                                                        <input class="form-check-input state-checkbox" type="checkbox" name="preferred_state"
                                                               value="{{ S }}" id="state-loc-{{ forloop.counter }}"
                                                               {% if S in candidate.preferred_state %}checked{% endif %}>
                                                        <label class="form-check-label w-100" for="state-loc-{{ forloop.counter }}">
                                                            {{ S }}
                                                        </label>
                                                    </div>
                                                </li>
                                                {% endfor %}
                                            </div>
                                        </ul>
                                    </div>
                                    <div class="invalid-feedback">
                                        Please select at least one state
                                    </div>
                                </div>
                                
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Preferred Location</label>
                                    <div class="dropdown">
                                        <button class="btn btn-outline-secondary dropdown-toggle w-100 text-start" type="button"
                                                id="locationDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                                            {% if candidate.preferred_location %}
                                                {% if candidate.preferred_location|length > 2 %}
                                                    {{ candidate.preferred_location|length }} locations selected
                                                {% else %}
                                                    {{ candidate.preferred_location }}
                                                {% endif %}
                                            {% else %}
                                                Select locations...
                                            {% endif %}
                                        </button>
                                        <ul class="dropdown-menu w-100 p-2" aria-labelledby="locationDropdown">
                                            <li>
                                                <div class="px-2 mb-2">
                                                    <input type="text" class="form-control search-input"
                                                           placeholder="Search locations..."
                                                           id="locationSearch">
                                                </div>
                                            </li>
                                            <div class="dropdown-options" style="max-height: 250px; overflow-y: auto;">
                                                {% for district in districts %}
                                                <li class="dropdown-item">
                                                    <div class="form-check">
                                                        <input class="form-check-input location-checkbox" type="checkbox" name="preferred_location"
                                                               value="{{ district }}" id="loc-{{ forloop.counter }}"
                                                               {% if district in candidate.preferred_location %}checked{% endif %}>
                                                        <label class="form-check-label w-100" for="loc-{{ forloop.counter }}">
                                                            {{ district }}
                                                        </label>
                                                    </div>
                                                </li>
                                                {% endfor %}
                                                <li class="dropdown-item">
                                                    <div class="form-check">
                                                        <input class="form-check-input location-checkbox" type="checkbox" name="preferred_location"
                                                               value="Other" id="loc-others"
                                                               {% if "Other" in candidate.preferred_location %}checked{% endif %}>
                                                        <label class="form-check-label w-100" for="loc-others">
                                                            Other
                                                        </label>
                                                    </div>
                                                </li>
                                            </div>
                                        </ul>
                                    </div>
                                    <div class="invalid-feedback">
                                        Please select at least one location
                                    </div>
                                </div>

                                <div class="col-md-6 mb-3" id="otherPreferredLocationField" style="display: none;">
                                    <label class="form-label">Please specify other location(s)</label>
                                    <input type="text" class="form-control" name="other_preferred_location"
                                           placeholder="Enter other preferred locations (comma separated)"
                                           value="{% if candidate.other_preferred_location %}{{ candidate.other_preferred_location }}{% endif %}">
                                </div>
                                
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Candidate Origin Location</label>
                                    <div class="custom-dropdown">
                                        <div class="dropdown-input-container">
                                            <input type="text" class="form-control dropdown-search-input"
                                                   placeholder="Search locations..."
                                                   id="originLocationSearch"
                                                   {% if candidate.origin_location %}value="{{ candidate.origin_location }}"{% endif %}>
                                            <button class="dropdown-toggle-btn" type="button">
                                                <i class="fas fa-chevron-down"></i>
                                            </button>
                                        </div>
                                        
                                        <div class="dropdown-options" id="originLocationOptions" style="display: none;">
                                            {% for district in districts %}
                                            <div class="dropdown-option" data-value="{{ district }}">
                                                {{ district }}
                                            </div>
                                            {% endfor %}
                                            <div class="dropdown-option" data-value="Other">
                                                Other
                                            </div>
                                        </div>
                                        
                                        <select name="origin_location" id="originLocation" style="display: none;">
                                            {% if candidate.origin_location %}
                                                <option value="{{ candidate.origin_location }}" selected>{{ candidate.origin_location }}</option>
                                            {% endif %}
                                        </select>
                                    </div>
                                    
                                    <div id="otherOriginLocation" style="display: none;" class="mt-2">
                                        <label class="form-label">Specify Other Candidate Origin Location</label>
                                        <input type="text" class="form-control" name="other_origin_location"
                                               value="{{ candidate.other_origin_location }}" maxlength="100">
                                    </div>
                                    <div class="invalid-feedback">
                                        Maximum 100 characters allowed
                                    </div>
                                </div>

                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Qualification</label>
                                    <select class="form-select" name="qualification" id="qualificationSelect">
                                        <option value="">Select Qualification</option>
                                        <option value="High School" {% if candidate.qualification == "High School" %}selected{% endif %}>High School</option>
                                        <option value="Higher Secondary" {% if candidate.qualification == "Higher Secondary" %}selected{% endif %}>Higher Secondary</option>
                                        <option value="Bachelor's Degree" {% if candidate.qualification == "Bachelor's Degree" %}selected{% endif %}>Bachelor's Degree</option>
                                        <option value="Master's Degree" {% if candidate.qualification == "Master's Degree" %}selected{% endif %}>Master's Degree</option>
                                        <option value="PhD" {% if candidate.qualification == "PhD" %}selected{% endif %}>PhD</option>
                                        <option value="Other" {% if candidate.qualification == "Other" %}selected{% endif %}>Other</option>
                                    </select>
                                    <div id="otherQualificationContainer" style="display: none;" class="mt-2">
                                        <label class="form-label">Specify Other Qualification</label>
                                        <input type="text" class="form-control" name="other_qualification"
                                               value="{{ candidate.other_qualification }}" maxlength="100">
                                    </div>
                                </div>
                                
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Diploma</label>
                                    <input type="text" class="form-control" name="diploma"
                                           value="{{candidate.diploma}}"
                                           maxlength="100">
                                    <div class="invalid-feedback">
                                        Maximum 100 characters allowed
                                    </div>
                                </div>
                                
                                <div class="col-sm-6 col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label">Sector</label>
                                        <div class="dropdown">
                                            <button class="btn btn-outline-secondary dropdown-toggle w-100 text-start" type="button"
                                                    id="sectorDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                                                {% if candidate.sector %}
                                                    {% if candidate.sector|length > 2 %}
                                                        {{ candidate.sector|length }} sectors selected
                                                    {% else %}
                                                        {{ candidate.sector }}
                                                    {% endif %}
                                                {% else %}
                                                    Select sectors...
                                                {% endif %}
                                            </button>
                                            <ul class="dropdown-menu w-100 p-2" aria-labelledby="sectorDropdown">
                                                <li>
                                                    <div class="px-2 mb-2">
                                                        <input type="text" class="form-control sector-search-input"
                                                               placeholder="Search sectors..."
                                                               id="sectorSearch">
                                                    </div>
                                                </li>
                                                <div class="dropdown-options" style="max-height: 250px; overflow-y: auto;">
                                                    {% for job_sector in job_sectors %}
                                                    <li class="dropdown-item">
                                                        <div class="form-check">
                                                            <input class="form-check-input sector-checkbox" type="checkbox" name="sector"
                                                                   value="{{ job_sector }}" id="sector-{{ forloop.counter }}"
                                                                   {% if job_sector in candidate.sector %}checked{% endif %}>
                                                            <label class="form-check-label w-100" for="sector-{{ forloop.counter }}">
                                                                {{ job_sector }}
                                                            </label>
                                                        </div>
                                                    </li>
                                                    {% endfor %}
                                                    <li class="dropdown-item">
                                                        <div class="form-check">
                                                            <input class="form-check-input sector-checkbox" type="checkbox" name="sector"
                                                                   value="Other" id="sector-others"
                                                                   {% if "Other" in candidate.sector %}checked{% endif %}>
                                                            <label class="form-check-label w-100" for="sector-others">
                                                                Other
                                                            </label>
                                                        </div>
                                                    </li>
                                                </div>
                                            </ul>
                                        </div>
                                        <div class="invalid-feedback">Please select at least one sector.</div>
                                    </div>
                                </div>

                                <div class="col-sm-6 col-md-6 mb-3" id="otherSectorField" style="display: none;">
                                    <label class="form-label">Please specify other sector(s)</label>
                                    <input type="text" class="form-control" name="other_sector"
                                           placeholder="Enter other sectors (comma separated)"
                                           value="{% if candidate.other_sector %}{{ candidate.other_sector }}{% endif %}">
                                </div>
                                
                                <div class="col-sm-6 col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label">Department</label>
                                        <div class="dropdown">
                                            <button class="btn btn-outline-secondary dropdown-toggle w-100 text-start" type="button"
                                                    id="departmentDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                                                {% if candidate.department %}
                                                    {% if candidate.department|length > 2 %}
                                                        {{ candidate.department|length }} departments selected
                                                    {% else %}
                                                        {{ candidate.department }}
                                                    {% endif %}
                                                {% else %}
                                                    Select departments...
                                                {% endif %}
                                            </button>
                                            <ul class="dropdown-menu w-100 p-2" aria-labelledby="departmentDropdown">
                                                <li>
                                                    <div class="px-2 mb-2">
                                                        <input type="text" class="form-control department-search-input"
                                                               placeholder="Search departments..."
                                                               id="departmentSearch">
                                                    </div>
                                                </li>
                                                <div class="dropdown-options" style="max-height: 250px; overflow-y: auto;">
                                                    {% for department in departments %}
                                                    <li class="dropdown-item">
                                                        <div class="form-check">
                                                            <input class="form-check-input department-checkbox" type="checkbox" name="department"
                                                                   value="{{ department }}" id="dept-{{ forloop.counter }}"
                                                                   {% if department in candidate.department %}checked{% endif %}>
                                                            <label class="form-check-label w-100" for="dept-{{ forloop.counter }}">
                                                                {{ department }}
                                                            </label>
                                                        </div>
                                                    </li>
                                                    {% endfor %}
                                                    <li class="dropdown-item">
                                                        <div class="form-check">
                                                            <input class="form-check-input department-checkbox" type="checkbox" name="department"
                                                                   value="Other" id="dept-others"
                                                                   {% if "Other" in candidate.department %}checked{% endif %}>
                                                            <label class="form-check-label w-100" for="dept-others">
                                                                Other
                                                            </label>
                                                        </div>
                                                    </li>
                                                </div>
                                            </ul>
                                        </div>
                                        <div class="invalid-feedback">Please select at least one department.</div>
                                    </div>
                                </div>

                                <div class="col-sm-6 col-md-6 mb-3" id="otherDepartmentField" style="display: none;">
                                    <label class="form-label">Please specify other department(s)</label>
                                    <input type="text" class="form-control" name="other_department"
                                           placeholder="Enter other departments (comma separated)"
                                           value="{% if candidate.other_department %}{{ candidate.other_department }}{% endif %}">
                                </div>
                                
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Experience (In Years)</label>
                                    <input type="number" class="form-control" name="experience_year"
                                           value="{{candidate.experience_year}}"
                                           min="0" max="50" step="1">
                                    <div class="invalid-feedback">
                                        Please enter a value between 0-50 years
                                    </div>
                                </div>
                                
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Experience (In Months)</label>
                                    <input type="number" class="form-control" name="experience_month"
                                           value="{{candidate.experience_month}}"
                                           min="0" max="11" step="1">
                                    <div class="invalid-feedback">
                                        Please enter a value between 0-11 months
                                    </div>
                                </div>
                                
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Current Company</label>
                                    <input type="text" class="form-control" name="current_company"
                                           value="{{candidate.current_company}}" maxlength="100">
                                    <div class="invalid-feedback">
                                        Maximum 100 characters allowed
                                    </div>
                                </div>
                                
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Working Status</label>
                                    <select class="form-select" name="current_working_status" id="workingStatusSelect">
                                        <option value="">Select Status</option>
                                        <option value="Employed" {% if candidate.current_working_status == "Employed" %}selected{% endif %}>Employed</option>
                                        <option value="Unemployed" {% if candidate.current_working_status == "Unemployed" %}selected{% endif %}>Unemployed</option>
                                        <option value="Student" {% if candidate.current_working_status == "Student" %}selected{% endif %}>Student</option>
                                        <option value="Freelancer" {% if candidate.current_working_status == "Freelancer" %}selected{% endif %}>Freelancer</option>
                                        <option value="Other" {% if candidate.current_working_status == "Other" %}selected{% endif %}>Other</option>
                                    </select>
                                    <div id="otherWorkingStatusContainer" style="display: none;" class="mt-2">
                                        <label class="form-label">Specify Other Working Status</label>
                                        <input type="text" class="form-control" name="other_working_status"
                                               value="{{ candidate.other_working_status }}" maxlength="100">
                                    </div>
                                </div>
                                
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Current Salary (₹)</label>
                                    <div class="input-group">
                                        <input type="number" class="form-control" name="current_salary"
                                                value="{{ candidate.current_salary }}" min="0" step="1">
                                        <select class="form-select" name="current_salary_type">
                                            <option value="(CTC)" {% if candidate.current_salary_type == '(CTC)' %}selected{% endif %}>CTC</option>
                                            <option value="(Per Month)" {% if candidate.current_salary_type == '(Per Month)' %}selected{% endif %}>Per Month</option>
                                            <option value="(In Hand)" {% if candidate.current_salary_type == '(In Hand)' %}selected{% endif %}>In Hand</option>
                                            <option value="(Per Annum)" {% if candidate.current_salary_type == '(Per Annum)' %}selected{% endif %}>Per Annum</option>
                                        </select>
                                    </div>
                                    <div class="invalid-feedback">
                                        Please enter a valid salary
                                    </div>
                                </div>
                                
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Expected Salary (₹)</label>
                                    <div class="input-group">
                                        <input type="number" class="form-control" name="expected_salary"
                                                value="{{ candidate.expected_salary }}" min="0" step="1">
                                        <select class="form-select" name="expected_salary_type">
                                            <option value="(CTC)" {% if candidate.expected_salary_type == '(CTC)' %}selected{% endif %}>CTC</option>
                                            <option value="(Per Month)" {% if candidate.expected_salary_type == '(Per Month)' %}selected{% endif %}>Per Month</option>
                                            <option value="(In Hand)" {% if candidate.expected_salary_type == '(In Hand)' %}selected{% endif %}>In Hand</option>
                                            <option value="(Per Annum)" {% if candidate.expected_salary_type == '(Per Annum)' %}selected{% endif %}>Per Annum</option>
                                        </select>
                                    </div>
                                    <div class="invalid-feedback">
                                        Please enter a valid salary
                                    </div>
                                </div>
                            </div>
                            <hr class="my-4">
                            <h5 class="text-secondary mb-4 sticky-section-header">Candidate Calling Details</h5>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Call Connection Status <span class="text-danger">*</span></label>
                                    <select class="form-select" name="call_connection" id="callConnection" required>
                                        <option value="" disabled selected>Select Status</option>
                                        <option value="Connected" {% if candidate.call_connection == "Connected" %}selected{% endif %}>Connected</option>
                                        <option value="Not Connected" {% if candidate.call_connection == "Not Connected" %}selected{% endif %}>Not Connected</option>
                                        <option value="Not Reachable" {% if candidate.call_connection == "Not Reachable" %}selected{% endif %}>Not Reachable</option>
                                        <option value="Busy" {% if candidate.call_connection == "Busy" %}selected{% endif %}>Busy</option>
                                        <option value="Wrong Number" {% if candidate.call_connection == "Wrong Number" %}selected{% endif %}>Wrong Number</option>
                                        <option value="Other" {% if candidate.call_connection == "Other" %}selected{% endif %}>Other</option>
                                    </select>
                                    <div id="otherCallConnectionContainer" style="display: none;" class="mt-2">
                                        <label class="form-label">Specify Other Call Connection Status</label>
                                        <input type="text" class="form-control" name="other_call_connection"
                                               value="{{ candidate.other_call_connection }}" maxlength="100">
                                    </div>
                                    <div class="invalid-feedback">Please select call connection status</div>
                                </div>
                            </div>

                            <div class="row" id="connectedFields" style="display: none;">
                                <div class="col-md-12 mb-3">
                                    <label class="form-label">Lead Status <span class="text-danger">*</span></label>
                                    <select class="form-select" name="lead_generate" id="leadGenerateSelect">
                                        <option value="" disabled selected>Select Status</option>
                                        <option value="Hot" {% if candidate.lead_generate == "Hot" %}selected{% endif %}>
                                            Hot <span class="text-muted">(Positive prospect but pending for Conversion for Interview scheduling)</span>
                                        </option>
                                        <option value="Cold" {% if candidate.lead_generate == "Cold" %}selected{% endif %}>
                                            Cold <span class="text-muted">(Not so interested)</span>
                                        </option>
                                        <option value="Converted" {% if candidate.lead_generate == "Converted" %}selected{% endif %}>
                                            Converted <span class="text-muted">(for Scheduling Interview)</span>
                                        </option>
                                        <option value="Not interested" {% if candidate.lead_generate == "Not interested" %}selected{% endif %}>
                                            Not interested <span class="text-muted">(Looking for different Jobs/Salary Range - mention in Remarks)</span>
                                        </option>
                                        <option value="Connect later" {% if candidate.lead_generate == "Connect later" %}selected{% endif %}>
                                            Connect later <span class="text-muted">(mention Follow-up date and time)</span>
                                        </option>
                                        <option value="DND" {% if candidate.lead_generate == "DND" %}selected{% endif %}>
                                            DND <span class="text-muted">(Candidate does not want to receive calls/messages)</span>
                                        </option>
                                        <option value="Other" {% if candidate.lead_generate == "Other" %}selected{% endif %}>
                                            Other <span class="text-muted">(mention in remarks)</span>
                                        </option>
                                    </select>
                                    <div id="otherLeadGenerateContainer" style="display: none;" class="mt-2">
                                        <label class="form-label">Specify Other Lead Generate Status</label>
                                        <input type="text" class="form-control" name="other_lead_generate"
                                               value="{{ candidate.other_lead_generate }}" maxlength="100">
                                    </div>
                                    <div class="invalid-feedback">
                                        Please select lead generation status
                                    </div>
                                </div>
                                
                                <div class="col-md-12 mb-3">
                                    <label class="form-label">Send for Interview Status <span class="text-danger">*</span></label>
                                    <select class="form-select" name="send_for_interview" id="interviewStatusSelect">
                                        <option value="" disabled selected>Select Status</option>
                                        <option value="Yes" {% if candidate.send_for_interview == "Yes" %}selected{% endif %}>Yes</option>
                                        <option value="No" {% if candidate.send_for_interview == "No" %}selected{% endif %}>No</option>
                                        <option value="Scheduled" {% if candidate.send_for_interview == "Scheduled" %}selected{% endif %}>Scheduled</option>
                                        <option value="Not Interested" {% if candidate.send_for_interview == "Not Interested" %}selected{% endif %}>Not Interested</option>
                                        <option value="Rescheduled" {% if candidate.send_for_interview == "Rescheduled" %}selected{% endif %}>Rescheduled</option>
                                        <option value="Completed" {% if candidate.send_for_interview == "Completed" %}selected{% endif %}>Completed</option>
                                        <option value="Other" {% if candidate.send_for_interview == "Other" %}selected{% endif %}>Other</option>
                                    </select>
                                    <div id="otherInterviewStatusContainer" style="display: none;" class="mt-2">
                                        <label class="form-label">Specify Other Interview Status</label>
                                        <input type="text" class="form-control" name="other_interview_status"
                                               value="{{ candidate.other_interview_status }}" maxlength="100">
                                    </div>
                                    <div class="invalid-feedback">
                                        Please select interview status
                                    </div>
                                </div>
                                
                                <div class="col-md-12 mb-3">
                                    <label class="form-label">Next Follow-Up Date <span class="text-danger">*</span></label>
                                    <input type="datetime-local" name="next_follow_up_date_time" class="form-control"
                                           value="{{ candidate.next_follow_up_date_time|date:'Y-m-d H:i' }}">
                                    <div class="invalid-feedback">
                                        Please select a valid future date
                                    </div>
                                </div>
                                <div class="col-md-6 mb-3">
                <label class="form-label">Call Remark <span class="text-danger">*</span></label>
                <select class="form-control form-select" name='calling_remark'>
                  <option value="" disabled selected>Select Status</option>
                  <option value="Lead Generate" {% if candidate.calling_remark == "Lead Generate" %}selected{% endif %}>Lead Generate</option>
                  <option value="Follow-Up" {% if candidate.calling_remark == "Follow-Up" %}selected{% endif %}>Follow-Up</option>
                  <option value="Shortlisted for Banking Counselling" {% if candidate.calling_remark == "Shortlisted for Banking Counselling" %}selected{% endif %}>Shortlisted for Banking Counselling</option>
                  <option value="RNR" {% if candidate.calling_remark == "RNR" %}selected{% endif %}>RNR</option>
                  <option value="Switch Off" {% if candidate.calling_remark == "Switch Off" %}selected{% endif %}>Switch Off</option>
                  <option value="Not Intrested" {% if candidate.calling_remark == "Not Intrested" %}selected{% endif %}>Not Intrested</option>
                  <option value="Sharing Resume" {% if candidate.calling_remark == "Sharing Resume" %}selected{% endif %}>Sharing Resume</option>
                  <option value="Hold" {% if candidate.calling_remark == "Hold" %}selected{% endif %}>Hold</option>
                  <option value="Not Eligeble" {% if candidate.calling_remark == "Not Eligeble" %}selected{% endif %}>Not Eligeble</option>
                  <option value="Call Back" {% if candidate.calling_remark == "Call Back" %}selected{% endif %}>Call Back</option>
                  <option value="Coming Tomorrow" {% if candidate.calling_remark == "Coming Tomorrow" %}selected{% endif %}>Coming Tomorrow</option>
                  <option value="Busy" {% if candidate.calling_remark == "Busy" %}selected{% endif %}>Busy</option>
                  <option value="Not Available" {% if candidate.calling_remark == "Not Available" %}selected{% endif %}>Not Available</option>
                  <option value="Got a Job" {% if candidate.calling_remark == "Got a Job" %}selected{% endif %}>Got a Job</option>
                  <option value="Call After Some Time" {% if candidate.calling_remark == "Call After Some Time" %}selected{% endif %}>Call After Some Time</option>
                  <option value="No Incoming" {% if candidate.calling_remark == "No Incoming" %}selected{% endif %}>No Incoming</option>
                  <option value="Temporary Not Available" {% if candidate.calling_remark == "Temporary Not Available" %}selected{% endif %}>Temporary Not Available</option>
                  <option value="Out Of Town" {% if candidate.calling_remark == "Out Of Town" %}selected{% endif %}>Out Of Town</option>
              </select>
                <div class="invalid-feedback">Please select Call Remark </div>
              </div>


                                <div class="col-md-12 mb-3">
                                    <label class="form-label">Remark <span class="text-danger">*</span></label>
                                    <textarea class="form-control" name="remark" rows="3" maxlength="500">{{ candidate.remark }}</textarea>
                                    <div class="invalid-feedback">
                                        Please enter calling remarks (max 500 characters)
                                    </div>
                                    <small class="text-muted">Characters remaining: <span id="remarkCounter">500</span></small>
                                </div>
                            </div>
                            <hr class="my-4">
                            <h5 class="text-secondary mb-4 sticky-section-header">Candidate Selection</h5>
                            <div class="row">
                                <div class="col-md-12 mb-3">
                                    <label class="form-label">Selection Status <span class="text-danger">*</span></label>
                                    <select class="form-select" name="selection_status" id="selectionStatus">
                                        <option value="" disabled selected>Select Status</option>
                                        <option value="Selected" {% if candidate.selection_status == "Selected" %}selected{% endif %}>Selected</option>
                                        <option value="Rejected" {% if candidate.selection_status == "Rejected" %}selected{% endif %}>Rejected</option>
                                        <option value="Pending" {% if candidate.selection_status == "Pending" %}selected{% endif %}>Pending</option>
                                        <option value="Not Join" {% if candidate.selection_status == "Not Join" %}selected{% endif %}>Not Join</option>
                                        <option value="Other" {% if candidate.selection_status == "Other" %}selected{% endif %}>Other</option>
                                    </select>

                                    <div id="otherSelectionStatusContainer" class="mt-2" style="display: none;">
                                        <label class="form-label">Specify Other Selection Status</label>
                                        <input type="text" class="form-control" name="other_selection_status" value="{{ candidate.other_selection_status }}" maxlength="100">
                                    </div>
                                    <div class="invalid-feedback">Please select candidate selection status</div>
                                </div>
                            </div>

                            <div class="row" id="selectionFields" style="display: none;">
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Company Name</label>
                                    <select class="form-select" name="company_name">
                                        {% for c in companies %}
                                            <option value="{{ c.company_name }}"
                                                    {% if candidate.company_name == c.company_name %}selected{% endif %}>
                                                {{ c.company_name }}
                                            </option>
                                        {% endfor %}
                                        <option value="Other" {% if candidate.company_name == "Other" %}selected{% endif %}>Other</option>
                                    </select>
                                </div>

                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Job Profile</label>
                                    <select class="form-select" name="job_title">
                                        {% for v in vacancies %}
                                            <option value="{{ v.job_profile }}"
                                                    {% if candidate.job_title == v.job_profile %}selected{% endif %}>
                                                {{ v.job_profile }} - {{ v.company__company_name }}
                                            </option>
                                        {% endfor %}
                                        <option value="Other" {% if candidate.job_title == "Other" %}selected{% endif %}>Other</option>
                                    </select>
                                </div>

                                <div class="col-md-12 mb-3">
                                    <label class="form-label">Selection Date <span class="text-danger">*</span></label>
                                    <input type="date" name="selection_date" class="form-control"
                                            value="{{ candidate.selection_date|date:'Y-m-d' }}" max="{% now 'Y-m-d' %}">
                                    <div class="invalid-feedback">Please select a valid selection date</div>
                                </div>

                                <div class="col-md-12 mb-3">
                                    <label class="form-label">Offered Salary (₹) <span class="text-danger">*</span></label>
                                    <input type="number" name="offered_salary" class="form-control"
                                            value="{{ candidate.offered_salary }}" min="0" step="1">
                                    <div class="invalid-feedback">Please enter a valid salary</div>
                                </div>

                                <div class="col-md-12 mb-3">
                                    <label class="form-label">Joining Status <span class="text-danger">*</span></label>
                                    <select class="form-select" name="joining_status" id="joiningStatus">
                                        <option value="" disabled>Select Candidate Joining Status</option>
                                        <option value="Pending" {% if candidate.joining_status == "Pending" %}selected{% endif %}>Pending</option>
                                        <option value="Joined" {% if candidate.joining_status == "Joined" %}selected{% endif %}>Joined</option>
                                        <option value="Not Joined" {% if candidate.joining_status == "Not Joined" %}selected{% endif %}>Not Joined</option>
                                    </select>
                                    <div class="invalid-feedback">Please select candidate joining status</div>
                                </div>
                            </div>

                            <div class="row" id="joinedFields" style="display: none;">
                                <div class="col-md-12 mb-3">
                                    <label class="form-label">Joining Date</label>
                                    <input type="date" name="candidate_joining_date" class="form-control"
                                            value="{{ candidate.candidate_joining_date|date:'Y-m-d' }}">
                                    <div class="invalid-feedback">Joining date must be after selection date</div>
                                </div>

                                <div class="col-md-12 mb-3">
                                    <label class="form-label">Our Commission (₹)</label>
                                    <input type="number" name="emta_commission" class="form-control"
                                            value="{{ candidate.emta_commission }}" min="0" step="1">
                                    <div class="invalid-feedback">Please enter a valid commission amount</div>
                                </div>

                                <div class="col-md-12 mb-3">
                                    <label class="form-label">Payout Date</label>
                                    <input type="date" name="payout_date" class="form-control"
                                            value="{{ candidate.payout_date|date:'Y-m-d' }}">
                                    <div class="invalid-feedback">Payout date must be after joining date</div>
                                </div>
                            </div>
                        </div>
                        <div class="tab-pane fade" id="interviews" role="tabpanel" aria-labelledby="interviews-tab">
                            <hr class="my-4">
                            <h5 class="text-secondary mb-4 sticky-section-header">Candidate Interviews</h5>
                            <button type="button" class="btn btn-primary mb-3" data-bs-toggle="modal" data-bs-target="#addInterviewModal">
                                <i class="fas fa-plus-circle me-2"></i>Add New Interview
                            </button>

                            <div class="accordion" id="interviewAccordion">
                                {% for interview in interviews %}
                                <div class="accordion-item mb-2">
                                    <h2 class="accordion-header" id="heading{{ interview.id }}">
                                        <button class="accordion-button {% if not forloop.first %}collapsed{% endif %}" type="button" data-bs-toggle="collapse" data-bs-target="#collapse{{ interview.id }}" aria-expanded="{% if forloop.first %}true{% else %}false{% endif %}" aria-controls="collapse{{ interview.id }}">
                                            Interview with {{ interview.company_name }} for {{ interview.job_position }} on {{ interview.interview_date_time|date:"F d, Y P" }}
                                            <span class="badge bg-{% if interview.status|lower|cut:" " == "scheduled" %}primary{% elif interview.status|lower|cut:" " == "completed" %}success{% elif interview.status|lower|cut:" " == "rejected" %}danger{% else %}info{% endif %} ms-3">{{ interview.status }}</span>
                                        </button>
                                    </h2>
                                    <div id="collapse{{ interview.id }}" class="accordion-collapse collapse {% if forloop.first %}show{% endif %}" aria-labelledby="heading{{ interview.id }}" data-bs-parent="#interviewAccordion">
                                        <div class="accordion-body">
                                            <div class="row mb-3">
                                                <div class="col-md-6"><strong>Company:</strong> {{ interview.company_name }}</div>
                                                <div class="col-md-6"><strong>Job Position:</strong> {{ interview.job_position }}</div>
                                            </div>
                                            <div class="row mb-3">
                                                <div class="col-md-6"><strong>Interviewer Name:</strong> {{ interview.interviewer_name }}</div>
                                                <div class="col-md-6"><strong>Interviewer Email:</strong> {{ interview.interviewer_email }}</div>
                                            </div>
                                            <div class="row mb-3">
                                                <div class="col-md-6"><strong>Interviewer Phone:</strong> {{ interview.interviewer_phone }}</div>
                                                <div class="col-md-6"><strong>Interview Mode:</strong> {{ interview.interview_mode }}</div>
                                            </div>
                                            <div class="row mb-3">
                                                <div class="col-md-6"><strong>Location:</strong> {{ interview.location }}</div>
                                                <div class="col-md-6"><strong>Meeting Link:</strong> <a href="{{ interview.meeting_link }}" target="_blank">{{ interview.meeting_link }}</a></div>
                                            </div>
                                            <div class="row mb-3">
                                                <div class="col-md-6"><strong>Status:</strong> {{ interview.status }}</div>
                                                <div class="col-md-6"><strong>Is Technical:</strong> {% if interview.is_technical %}Yes{% else %}No{% endif %}</div>
                                            </div>
                                            <div class="row mb-3">
                                                <div class="col-md-6"><strong>Duration:</strong> {{ interview.duration }} minutes</div>
                                                <div class="col-md-6"><strong>Rating:</strong> {{ interview.rating|default:"N/A" }}</div>
                                            </div>
                                            <div class="mb-3"><strong>Notes:</strong> {{ interview.notes|default:"N/A" }}</div>
                                            <div class="mb-3"><strong>Feedback:</strong> {{ interview.feedback|default:"N/A" }}</div>
                                            <div class="mb-3"><strong>Requirements:</strong> {{ interview.requirements|default:"N/A" }}</div>
                                            {% if interview.attachment %}
                                            <div class="mb-3">
                                                <strong>Attachment:</strong> <a href="{{ interview.attachment.url }}" target="_blank">View Attachment</a>
                                            </div>
                                            {% endif %}
                                            <div class="text-end">
                                                <button type="button" class="btn btn-sm btn-warning me-2" data-bs-toggle="modal" data-bs-target="#editInterviewModal"
                                                        data-interview-id="{{ interview.id }}"
                                                        data-interview-datetime="{{ interview.interview_date_time|date:'Y-m-d\TH:i' }}"
                                                        data-company-name="{{ interview.company_name }}"
                                                        data-job-position="{{ interview.job_position }}"
                                                        data-interviewer-name="{{ interview.interviewer_name }}"
                                                        data-interviewer-email="{{ interview.interviewer_email }}"
                                                        data-interviewer-phone="{{ interview.interviewer_phone }}"
                                                        data-status="{{ interview.status }}"
                                                        data-interview-mode="{{ interview.interview_mode }}"
                                                        data-location="{{ interview.location }}"
                                                        data-meeting-link="{{ interview.meeting_link }}"
                                                        data-notes="{{ interview.notes }}"
                                                        data-feedback="{{ interview.feedback }}"
                                                        data-rating="{{ interview.rating }}"
                                                        data-is-technical="{{ interview.is_technical|yesno:'on,off' }}"
                                                        data-duration="{{ interview.duration }}"
                                                        data-requirements="{{ interview.requirements }}"
                                                        data-attachment="{% if interview.attachment %}{{ interview.attachment.url }}{% else %}{% endif %}">
                                                        Edit
                                                </button>
                                                <button type="button" class="btn btn-sm btn-danger" data-bs-toggle="modal" data-bs-target="#deleteInterviewModal"
                                                        data-interview-id="{{ interview.id }}">
                                                        Delete
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                {% empty %}
                                <p class="text-muted">No interviews scheduled for this candidate yet.</p>
                                {% endfor %}
                            </div>
                        </div>
                        <div class="tab-pane fade" id="vendor" role="tabpanel" aria-labelledby="vendor-tab">
                            <hr class="my-4">
                            <h5 class="text-secondary mb-4 sticky-section-header">Vendor Data</h5>
                            <input type="hidden" name="submit_vendor_related_data" value="true">
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Admin Status <span class="text-danger">*</span></label>
                                    <select class="form-select" name="admin_status">
                                        <option value="" disabled selected>Select Admin Status</option>
                                        <option value="Pending" {% if candidate.admin_status == "Pending" %}selected{% endif %}>Pending</option>
                                        <option value="Complete" {% if candidate.admin_status == "Complete" %}selected{% endif %}>Complete</option>
                                        <option value="Failed" {% if candidate.admin_status == "Failed" %}selected{% endif %}>Failed</option>
                                        <option value="In Process" {% if candidate.admin_status == "In Process" %}selected{% endif %}>In Process</option>
                                    </select>
                                    <div class="invalid-feedback">
                                        Please select admin status
                                    </div>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Vendor Commission (₹) <span class="text-danger">*</span></label>
                                    <input type="number" name="vendor_commission" class="form-control"
                                           value="{{ candidate.vendor_commission|default:0 }}"
                                           min="0" step="1">
                                    <div class="invalid-feedback">
                                        Please enter a valid commission amount (minimum ₹0)
                                    </div>
                                </div>

                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Commission Generate Date <span class="text-danger">*</span></label>
                                    <input type="date" name="commission_generation_date" class="form-control"
                                           value="{{ candidate.commission_generation_date|date:'Y-m-d' }}">
                                    <div class="invalid-feedback">
                                        Please select a valid date
                                    </div>
                                </div>
                                
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Expected Vendor Payout Date <span class="text-danger">*</span></label>
                                    <input type="date" name="vendor_payout_date" class="form-control"
                                           value="{{ candidate.vendor_payout_date|date:'Y-m-d' }}">
                                    <div class="invalid-feedback">
                                        Please select a valid future date
                                    </div>
                                </div>
                                
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Payment Status <span class="text-danger">*</span></label>
                                    <select class="form-select" name="vendor_commission_status">
                                        <option value="" disabled selected>Select Payment Status</option>
                                        <option value="Complete" {% if candidate.vendor_commission_status == "Complete" %}selected{% endif %}>Complete</option>
                                        <option value="Failed" {% if candidate.vendor_commission_status == "Failed" %}selected{% endif %}>Failed</option>
                                        <option value="In Process" {% if candidate.vendor_commission_status == "In Process" %}selected{% endif %}>In Process</option>
                                        <option value="Pending" {% if candidate.vendor_commission_status == "Pending" %}selected{% endif %}>Pending</option>
                                    </select>
                                    <div class="invalid-feedback">
                                        Please select payment status
                                    </div>
                                </div>

                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Payment Done By</label>
                                    <input type="text" name="payment_done_by" class="form-control"
                                           value="{{ candidate.payment_done_by|default:request.user.get_full_name }}">
                                    <div class="invalid-feedback">
                                        Please enter who processed this payment
                                    </div>
                                </div>

                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Payment Done Date</label>
                                    <input type="date" name="payment_done_by_date" class="form-control"
                                           value="{{ candidate.payment_done_by_date|date:'Y-m-d' }}"
                                           max="{% now 'Y-m-d' %}">
                                    <div class="invalid-feedback">
                                        Please select a valid date (cannot be future date)
                                    </div>
                                </div>

                                <div class="col-md-12 mb-3">
                                    <label class="form-label">Payment Receipt</label>
                                    <input type="file" name="submit_recipt" class="form-control" accept=".pdf,.jpg,.jpeg,.png">
                                    {% if candidate.submit_recipt %}
                                        <div class="mt-2">
                                            <small class="text-muted">Current file:
                                                <a href="{{ candidate.submit_recipt.url }}" target="_blank">View Receipt</a>
                                                <div class="form-check form-check-inline ms-2">
                                                    <input class="form-check-input" type="checkbox" name="submit_recipt-clear" id="submitReciptClear">
                                                    <label class="form-check-label" for="submitReciptClear">Clear</label>
                                                </div>
                                            </small>
                                        </div>
                                    {% endif %}
                                    <div class="invalid-feedback">
                                        Please upload a valid receipt (PDF, JPG, PNG)
                                    </div>
                                </div>

                                <div class="col-md-12 mb-3">
                                    <label class="form-label">Vendor Remark for Payment <span class="text-danger">*</span></label>
                                    <textarea class="form-control" name="vendor_payment_remark" rows="3" maxlength="500">{{ candidate.vendor_payment_remark }}</textarea>
                                    <div class="invalid-feedback">
                                        Please enter Vendor Remark for Payments (max 500 characters)
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="tab-pane fade" id="invoice" role="tabpanel" aria-labelledby="invoice-tab">
                            <hr class="my-4">
                            <h5 class="text-secondary mb-4 sticky-section-header">Invoice Data</h5>
                            <input type="hidden" name="invoice_releted_data" value="true">
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Invoice Number</label>
                                    <input type="text" name="invoice_number" class="form-control"
                                           value="{{ candidate.invoice_number|default:'' }}">
                                    <div class="invalid-feedback">
                                        Please enter a valid invoice number
                                    </div>
                                </div>
                                
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Invoice Status <span class="text-danger">*</span></label>
                                    <select class="form-select" name="invoice_status">
                                        <option value="" disabled selected>Select Invoice Status</option>
                                        <option value="Complete" {% if candidate.invoice_status == "Complete" %}selected{% endif %}>Complete</option>
                                        <option value="Failed" {% if candidate.invoice_status == "Failed" %}selected{% endif %}>Failed</option>
                                        <option value="In Process" {% if candidate.invoice.status == "In Process" %}selected{% endif %}>In Process</option>
                                        <option value="Pending" {% if candidate.invoice_status == "Pending" %}selected{% endif %}>Pending</option>
                                    </select>
                                    <div class="invalid-feedback">
                                        Please select invoice status
                                    </div>
                                </div>

                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Invoice Paid Status <span class="text-danger">*</span></label>
                                    <select class="form-select" name="invoice_paid_status">
                                        <option value="" disabled selected>Select Invoice Paid Status</option>
                                        <option value="Paid" {% if candidate.invoice_paid_status == "Paid" %}selected{% endif %}>Paid</option>
                                        <option value="Unpaid" {% if candidate.invoice_paid_status == "Unpaid" %}selected{% endif %}>Unpaid</option>
                                        <option value="Hold" {% if candidate.invoice_paid_status == "Hold" %}selected{% endif %}>Hold</option>
                                    </select>
                                    <div class="invalid-feedback">
                                        Please select invoice paid status
                                    </div>
                                </div>

                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Invoice Date</label>
                                    <input type="date" name="invoice_date" class="form-control"
                                           value="{{ candidate.invoice_date|date:'Y-m-d' }}"
                                           max="{% now 'Y-m-d' %}">
                                    <div class="invalid-feedback">
                                        Please select a valid date (cannot be future date)
                                    </div>
                                </div>

                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Invoice Amount</label>
                                    <input type="number" name="invoice_amount" class="form-control"
                                           value="{{ candidate.invoice_amount|default:0 }}">
                                    <div class="invalid-feedback">
                                        Please enter a valid invoice amount (minimum ₹0)
                                    </div>
                                </div>

                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Invoice Attachment</label>
                                    <input type="file" name="invoice_attachment" class="form-control" accept=".pdf,.jpg,.jpeg,.png">
                                    {% if candidate.invoice_attachment %}
                                        <div class="mt-2">
                                            <small class="text-muted">Current file:
                                                <a href="{{ candidate.invoice_attachment.url }}" target="_blank">View Attachment</a>
                                                <div class="form-check form-check-inline ms-2">
                                                    <input class="form-check-input" type="checkbox" name="clear_invoice_attachment" id="invoiceAttachmentClear">
                                                    <label class="form-check-label" for="invoiceAttachmentClear">Clear</label>
                                                </div>
                                            </small>
                                        </div>
                                    {% endif %}
                                    <div class="invalid-feedback">
                                        Please upload a valid invoice attachment (PDF, JPG, PNG)
                                    </div>
                                </div>

                                <div class="col-md-12 mb-3">
                                    <label class="form-label">Invoice Remark <span class="text-danger">*</span></label>
                                    <textarea class="form-control" name="invoice_remark" rows="3" maxlength="500">{{ candidate.invoice_remark }}</textarea>
                                    <div class="invalid-feedback">
                                        Please enter Invoice Remark (max 500 characters)
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="tab-pane fade" id="activities" role="tabpanel" aria-labelledby="activities-tab">
                            <hr class="my-4">
                            <h5 class="text-secondary mb-4 sticky-section-header">Candidate Activities Log</h5>
                            <div class="list-group">
                                {% for activity in activities %}
                                <div class="list-group-item list-group-item-action flex-column align-items-start">
                                    <div class="d-flex w-100 justify-content-between">
                                        <h6 class="mb-1">
                                            <strong>{{ activity.employee.first_name }} {{ activity.employee.last_name }}</strong>
                                            <small class="text-muted ms-2">{{ activity.timestamp|date:"F d, Y P" }}</small>
                                        </h6>
                                        <span class="badge bg-info">{{ activity.action|capfirst }}</span>
                                    </div>
                                    <p class="mb-1 text-muted">{{ activity.remark }}</p>
                                    {% if activity.changes %}
                                    <small>
                                        <strong>Changes:</strong>
                                        <ul class="list-unstyled mb-0">
                                            {% for field, change in activity.changes.items %}
                                                <li><strong>{{ field|capfirst }}:</strong> From "{{ change.old|default:"N/A" }}" to "{{ change.new|default:"N/A" }}"</li>
                                            {% endfor %}
                                        </ul>
                                    </small>
                                    {% endif %}
                                </div>
                                {% empty %}
                                <p class="text-muted">No activities recorded for this candidate yet.</p>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer" style="position: sticky; bottom: -30px; z-index: 1050; background: var(--tblr-bg-surface); border-top: 1px solid var(--tblr-border-color);">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" name="submit_all" class="btn btn-primary">Save All Changes</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<div class="modal modal-blur fade" id="addInterviewModal" tabindex="-1" aria-labelledby="addInterviewModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <form method="post" enctype="multipart/form-data" id="addInterviewForm" novalidate>
                {% csrf_token %}
                <input type="hidden" name="add_interview_submit" value="true">
                <div class="modal-header">
                    <h5 class="modal-title" id="addInterviewModalLabel">Add New Interview</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Interview Date & Time <span class="text-danger">*</span></label>
                            <input type="datetime-local" class="form-control" name="interview_date_time" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Company Name <span class="text-danger">*</span></label>
                            <select class="form-select" name="interview_company_name" required>
                                <option value="" disabled selected>Select Company</option>
                                {% for c in companies %}
                                    <option value="{{ c.company_name }}">{{ c.company_name }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Job Position <span class="text-danger">*</span></label>
                            <select class="form-select" name="job_position" required>
                                <option value="" disabled selected>Select Job Position</option>
                                {% for v in vacancies %}
                                    <option value="{{ v.job_profile }}">{{ v.job_profile }} - {{ v.company__company_name }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Interviewer Name</label>
                            <input type="text" class="form-control" name="interviewer_name" maxlength="100">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Interviewer Email</label>
                            <input type="email" class="form-control" name="interviewer_email" maxlength="100">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Interviewer Phone</label>
                            <input type="tel" class="form-control" name="interviewer_phone" pattern="[0-9]{10}">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Status <span class="text-danger">*</span></label>
                            <select class="form-select" name="status" required>
                                <option value="" disabled selected>Select Status</option>
                                {% for status_value, status_label in interview_statuses %}
                                    <option value="{{ status_value }}">{{ status_label }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Interview Mode <span class="text-danger">*</span></label>
                            <select class="form-select" name="interview_mode" required>
                                <option value="" disabled selected>Select Mode</option>
                                {% for mode_value, mode_label in interview_modes %}
                                    <option value="{{ mode_value }}">{{ mode_label }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Location</label>
                            <input type="text" class="form-control" name="location" maxlength="255">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Meeting Link</label>
                            <input type="url" class="form-control" name="meeting_link" maxlength="255">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Rating (1-5)</label>
                            <input type="number" class="form-control" name="rating" min="1" max="5" step="1">
                        </div>
                        <div class="col-md-6 mb-3 form-check form-switch d-flex align-items-center pt-4">
                            <input class="form-check-input" type="checkbox" role="switch" id="isTechnical" name="is_technical">
                            <label class="form-check-label ms-2" for="isTechnical">Is Technical Interview?</label>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Duration (in minutes)</label>
                            <input type="number" class="form-control" name="duration" min="1" step="1">
                        </div>
                        <div class="col-md-12 mb-3">
                            <label class="form-label">Notes</label>
                            <textarea class="form-control" name="notes" rows="3" maxlength="500"></textarea>
                        </div>
                        <div class="col-md-12 mb-3">
                            <label class="form-label">Feedback</label>
                            <textarea class="form-control" name="feedback" rows="3" maxlength="500"></textarea>
                        </div>
                        <div class="col-md-12 mb-3">
                            <label class="form-label">Requirements (Skills, etc.)</label>
                            <textarea class="form-control" name="requirements" rows="3" maxlength="500"></textarea>
                        </div>
                        <div class="col-md-12 mb-3">
                            <label class="form-label">Attachment</label>
                            <input type="file" class="form-control" name="interview_attachment" accept=".pdf,.doc,.docx,.jpg,.jpeg,.png">
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">Add Interview</button>
                </div>
            </form>
        </div>
    </div>
</div>

<div class="modal modal-blur fade" id="editInterviewModal" tabindex="-1" aria-labelledby="editInterviewModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <form method="post" enctype="multipart/form-data" id="editInterviewForm" novalidate>
                {% csrf_token %}
                <input type="hidden" name="edit_interview_submit" value="true">
                <input type="hidden" name="interview_id" id="edit_interview_id">
                <div class="modal-header">
                    <h5 class="modal-title" id="editInterviewModalLabel">Edit Interview</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Interview Date & Time <span class="text-danger">*</span></label>
                            <input type="datetime-local" class="form-control" name="interview_date_time" id="edit_interview_date_time" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Company Name <span class="text-danger">*</span></label>
                            <select class="form-select" name="interview_company_name" id="edit_interview_company_name" required>
                                <option value="" disabled selected>Select Company</option>
                                {% for c in companies %}
                                    <option value="{{ c.company_name }}">{{ c.company_name }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Job Position <span class="text-danger">*</span></label>
                            <select class="form-select" name="job_position" id="edit_job_position" required>
                                <option value="" disabled selected>Select Job Position</option>
                                {% for v in vacancies %}
                                    <option value="{{ v.job_profile }}">{{ v.job_profile }} - {{ v.company__company_name }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Interviewer Name</label>
                            <input type="text" class="form-control" name="interviewer_name" id="edit_interviewer_name" maxlength="100">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Interviewer Email</label>
                            <input type="email" class="form-control" name="interviewer_email" id="edit_interviewer_email" maxlength="100">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Interviewer Phone</label>
                            <input type="tel" class="form-control" name="interviewer_phone" id="edit_interviewer_phone" pattern="[0-9]{10}">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Status <span class="text-danger">*</span></label>
                            <select class="form-select" name="status" id="edit_interview_status" required>
                                <option value="" disabled selected>Select Status</option>
                                {% for status_value, status_label in interview_statuses %}
                                    <option value="{{ status_value }}">{{ status_label }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Interview Mode <span class="text-danger">*</span></label>
                            <select class="form-select" name="interview_mode" id="edit_interview_mode" required>
                                <option value="" disabled selected>Select Mode</option>
                                {% for mode_value, mode_label in interview_modes %}
                                    <option value="{{ mode_value }}">{{ mode_label }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Location</label>
                            <input type="text" class="form-control" name="location" id="edit_location" maxlength="255">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Meeting Link</label>
                            <input type="url" class="form-control" name="meeting_link" id="edit_meeting_link" maxlength="255">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Rating (1-5)</label>
                            <input type="number" class="form-control" name="rating" id="edit_rating" min="1" max="5" step="1">
                        </div>
                        <div class="col-md-6 mb-3 form-check form-switch d-flex align-items-center pt-4">
                            <input class="form-check-input" type="checkbox" role="switch" id="edit_isTechnical" name="is_technical">
                            <label class="form-check-label ms-2" for="edit_isTechnical">Is Technical Interview?</label>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Duration (in minutes)</label>
                            <input type="number" class="form-control" name="duration" id="edit_duration" min="1" step="1">
                        </div>
                        <div class="col-md-12 mb-3">
                            <label class="form-label">Notes</label>
                            <textarea class="form-control" name="notes" id="edit_notes" rows="3" maxlength="500"></textarea>
                        </div>
                        <div class="col-md-12 mb-3">
                            <label class="form-label">Feedback</label>
                            <textarea class="form-control" name="feedback" id="edit_feedback" rows="3" maxlength="500"></textarea>
                        </div>
                        <div class="col-md-12 mb-3">
                            <label class="form-label">Requirements (Skills, etc.)</label>
                            <textarea class="form-control" name="requirements" id="edit_requirements" rows="3" maxlength="500"></textarea>
                        </div>
                        <div class="col-md-12 mb-3">
                            <label class="form-label">Attachment</label>
                            <input type="file" class="form-control" name="interview_attachment" id="edit_interview_attachment" accept=".pdf,.doc,.docx,.jpg,.jpeg,.png">
                            <div id="current_interview_attachment_display" class="mt-2"></div>
                            <div class="form-check form-check-inline ms-2">
                                <input class="form-check-input" type="checkbox" name="clear_interview_attachment" id="clear_edit_interview_attachment">
                                <label class="form-check-label" for="clear_edit_interview_attachment">Clear Existing Attachment</label>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save Changes</button>
                </div>
            </form>
        </div>
    </div>
</div>

<div class="modal modal-blur fade" id="deleteInterviewModal" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-sm modal-dialog-centered" role="document">
        <div class="modal-content">
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            <div class="modal-status bg-danger"></div>
            <div class="modal-body text-center py-4">
                <svg xmlns="http://www.w3.org/2000/svg" class="icon mb-2 text-danger icon-lg" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M10.24 3.99c.98 0 1.96 .06 2.94 .18a8.99 8.99 0 0 1 7.21 7.21a9.006 9.006 0 0 1 -1.41 5.28l-.06 .13l-4.2 4.2a1 1 0 0 1 -.7 .29h-.02a1 1 0 0 1 -.7 -.29l-4.2 -4.2l-.06 -.13a9.006 9.006 0 0 1 -1.41 -5.28a8.99 8.99 0 0 1 7.21 -7.21z" /><path d="M12 9v6m0 3v.01" /></svg>
                <h3>Are you sure?</h3>
                <div class="text-muted">Do you really want to delete this interview? This action cannot be undone.</div>
            </div>
            <div class="modal-footer">
                <div class="w-100">
                    <div class="row">
                        <div class="col">
                            <button type="button" class="btn w-100" data-bs-dismiss="modal">Cancel</button>
                        </div>
                        <div class="col">
                            <form method="post" id="deleteInterviewForm">
                                {% csrf_token %}
                                <input type="hidden" name="delete_interview_submit" value="true">
                                <input type="hidden" name="interview_id" id="delete_interview_id">
                                <button type="submit" class="btn btn-danger w-100">Delete</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    const modalBody = document.querySelector('.modal-body');
    const modalHeader = document.querySelector('.modal-header');
    // Select all sections within the tab-content
    const sections = document.querySelectorAll('.tab-content h5.text-secondary');
    
    // Create the sticky header element
    const stickyHeader = document.createElement('h5');
    stickyHeader.className = 'sticky-section-header text-secondary';
    stickyHeader.style.display = 'none';
    modalHeader.after(stickyHeader); // Place it right after the modal header
    
    // Add intersection observer to track which section is visible
    const observer = new IntersectionObserver(
        (entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    // Find the currently visible section that is at or above the top of the root
                    const visibleSection = Array.from(sections).find(section => {
                        const rect = section.getBoundingClientRect();
                        return rect.top >= 0 && rect.top <= modalBody.clientHeight; // Check if top is within modal body
                    });
                    
                    if (visibleSection) {
                        stickyHeader.textContent = visibleSection.textContent;
                        stickyHeader.style.display = 'block';
                    } else {
                        stickyHeader.style.display = 'none';
                    }
                }
            });
        }, 
        {
            root: modalBody, // Observe within the modal-body scroll area
            threshold: 0.1, // Trigger when 10% of the target is visible
            rootMargin: '-60px 0px -90% 0px' // Adjust based on your needs, fine-tune for sticky behavior
        }
    );
    
    // Observe each section
    sections.forEach(section => {
        observer.observe(section);
    });
    
    // Also observe the form's very first element to hide the sticky header when at the very top of the scrollable area
    const firstElementOfProfileTab = document.querySelector('#profile > *:first-child');
    if (firstElementOfProfileTab) {
        observer.observe(firstElementOfProfileTab);
    }

    // Main form elements
    const unifiedCandidateForm = document.getElementById('unifiedCandidateForm');
    const currentDate = new Date().toISOString().split('T')[0];
    
    // Field change confirmation for name, mobile, email
    const originalValues = {
      name: document.getElementById('candidateName').value,
      mobile: document.getElementById('candidateMobile').value,
      email: document.getElementById('candidateEmail').value
    };

    function checkChanges() {
      const currentValues = {
        name: document.getElementById('candidateName').value,
        mobile: document.getElementById('candidateMobile').value,
        email: document.getElementById('candidateEmail').value
      };

      const changes = [];
      if (currentValues.name !== originalValues.name) {
        changes.push('Name');
      }
      if (currentValues.mobile !== originalValues.mobile) {
        changes.push('Mobile Number');
      }
      if (currentValues.email !== originalValues.email) {
        changes.push('Email');
      }

      // Check for changes in file inputs (more complex as direct value comparison won't work)
      const photoInput = document.querySelector('input[name="candidate_photo"]');
      const resumeInput = document.querySelector('input[name="candidate_resume"]');

      if (photoInput && photoInput.files.length > 0) {
        changes.push('Candidate Photo');
      }
      if (resumeInput && resumeInput.files.length > 0) {
        changes.push('Candidate Resume');
      }

      if (changes.length > 0) {
        const message = `You are about to save changes including:\n${changes.join('\n')}\n\nAre you sure you want to proceed?`;
        return confirm(message); // User must confirm
      }
      return true; // No changes, proceed
    }

    // Add change event listeners for confirmation (only for the main profile fields)
    document.getElementById('candidateName').addEventListener('change', () => { if (!checkChanges()) { /* handle cancellation, e.g., revert value */ } });
    document.getElementById('candidateMobile').addEventListener('change', () => { if (!checkChanges()) { /* handle cancellation */ } });
    document.getElementById('candidateEmail').addEventListener('change', () => { if (!checkChanges()) { /* handle cancellation */ } });
    document.querySelector('input[name="candidate_photo"]').addEventListener('change', () => { if (!checkChanges()) { /* handle cancellation */ } });
    document.querySelector('input[name="candidate_resume"]').addEventListener('change', () => { if (!checkChanges()) { /* handle cancellation */ } });


    // Initialize dropdown search functionality for multi-selects
    function initializeMultiSelectSearch(dropdownType) {
        const searchInput = document.getElementById(`${dropdownType}Search`);
        if (!searchInput) return;

        searchInput.addEventListener('input', function() {
            const searchTerm = this.value.toLowerCase();
            const options = document.querySelectorAll(`#${dropdownType}Dropdown + .dropdown-menu .dropdown-item`);
            
            options.forEach(option => {
                const text = option.textContent.toLowerCase();
                option.style.display = text.includes(searchTerm) ? '' : 'none';
            });
        });
    }

    // Initialize all multi-select dropdown searches
    initializeMultiSelectSearch('state');
    initializeMultiSelectSearch('location');
    initializeMultiSelectSearch('sector');
    initializeMultiSelectSearch('department');

    // Update dropdown button text for multi-selects
    function updateMultiSelectButtonText(dropdownType) {
        const button = document.getElementById(`${dropdownType}Dropdown`);
        const checkboxes = document.querySelectorAll(`input[name="preferred_${dropdownType}"]:checked, input[name="${dropdownType}"]:checked`); // Handle both naming conventions
        const selectedItems = Array.from(checkboxes).map(cb => cb.value);
        
        if (selectedItems.length === 0) {
            button.textContent = `Select ${dropdownType}s...`;
        } else if (selectedItems.length > 2) {
            button.textContent = `${selectedItems.length} ${dropdownType}s selected`;
        } else {
            button.textContent = selectedItems.join(', ');
        }
    }

    // Initialize multi-select button text and add change listeners
    ['state', 'location', 'sector', 'department'].forEach(type => {
        updateMultiSelectButtonText(type);
        document.querySelectorAll(`input[name="preferred_${type}"], input[name="${type}"]`).forEach(checkbox => {
            checkbox.addEventListener('change', () => updateMultiSelectButtonText(type));
        });
    });

    // Toggle "Other" input fields for select elements
    function toggleOtherInput(selectElement, containerId) {
        const container = document.getElementById(containerId);
        if (!container) return;
        
        if (selectElement.value === 'Other') {
            container.style.display = 'block';
            // Optionally make the input required if "Other" is selected
            const input = container.querySelector('input');
            if (input) input.required = true; // Make it required when visible
        } else {
            container.style.display = 'none';
            const input = container.querySelector('input');
            if (input) {
                input.required = false; // Not required when hidden
                input.value = ''; // Clear value when hidden
            }
        }
    }

    // Initialize all "Other" input fields based on current values and add change listeners
    const otherInputMappings = [
        { selectId: 'leadSourceSelect', containerId: 'otherLeadSourceContainer' },
        { selectId: 'qualificationSelect', containerId: 'otherQualificationContainer' },
        { selectId: 'workingStatusSelect', containerId: 'otherWorkingStatusContainer' },
        { selectId: 'callConnection', containerId: 'otherCallConnectionContainer' },
        { selectId: 'leadGenerateSelect', containerId: 'otherLeadGenerateContainer' },
        { selectId: 'interviewStatusSelect', containerId: 'otherInterviewStatusContainer' },
        { selectId: 'selectionStatus', containerId: 'otherSelectionStatusContainer' }
    ];

    otherInputMappings.forEach(mapping => {
        const select = document.getElementById(mapping.selectId);
        if (select) {
            select.addEventListener('change', function() {
                toggleOtherInput(this, mapping.containerId);
            });
            // Initialize on load
            toggleOtherInput(select, mapping.containerId);
        }
    });

    // Custom dropdown for Origin Location
    const originLocationSearchInput = document.getElementById('originLocationSearch');
    const originLocationOptionsContainer = document.getElementById('originLocationOptions');
    const hiddenOriginLocationSelect = document.getElementById('originLocation');
    const otherOriginLocationField = document.getElementById('otherOriginLocation');

    if (originLocationSearchInput) {
        originLocationSearchInput.addEventListener('focus', function() {
            originLocationOptionsContainer.style.display = 'block';
            filterOriginLocationOptions();
        });
        
        originLocationSearchInput.addEventListener('input', filterOriginLocationOptions);

        function filterOriginLocationOptions() {
            const searchValue = originLocationSearchInput.value.toLowerCase();
            const options = originLocationOptionsContainer.querySelectorAll('.dropdown-option');
            
            options.forEach(option => {
                const text = option.textContent.toLowerCase();
                if (text.includes(searchValue)) {
                    option.style.display = 'block';
                } else {
                    option.style.display = 'none';
                }
            });
        }
        
        originLocationOptionsContainer.addEventListener('click', function(e) {
            const option = e.target.closest('.dropdown-option');
            if (option) {
                const value = option.getAttribute('data-value');
                const text = option.textContent;
                
                originLocationSearchInput.value = text;
                hiddenOriginLocationSelect.innerHTML = `<option value="${value}" selected>${text}</option>`;
                
                if (value === 'Other') {
                    otherOriginLocationField.style.display = 'block';
                    otherOriginLocationField.querySelector('input').required = true;
                } else {
                    otherOriginLocationField.style.display = 'none';
                    otherOriginLocationField.querySelector('input').required = false;
                    otherOriginLocationField.querySelector('input').value = '';
                }
                originLocationOptionsContainer.style.display = 'none';
            }
        });

        document.addEventListener('click', function(e) {
            if (!e.target.closest('.custom-dropdown')) {
                originLocationOptionsContainer.style.display = 'none';
            }
        });

        // Initialize origin location "Other" field display
        if (hiddenOriginLocationSelect.value === 'Other') {
            otherOriginLocationField.style.display = 'block';
            if (otherOriginLocationField.querySelector('input')) {
                otherOriginLocationField.querySelector('input').required = true;
            }
        }
    }

    // Toggle 'Other Preferred Location' field for multi-select checkbox
    const otherPreferredLocationCheckboxes = document.querySelectorAll('.location-checkbox');
    const otherPreferredLocationField = document.getElementById('otherPreferredLocationField');

    otherPreferredLocationCheckboxes.forEach(checkbox => {
        checkbox.addEventListener('change', function() {
            const othersChecked = document.getElementById('loc-others').checked;
            otherPreferredLocationField.style.display = othersChecked ? 'block' : 'none';
            if (otherPreferredLocationField.querySelector('input')) {
                otherPreferredLocationField.querySelector('input').required = othersChecked;
            }
        });
    });
    // Initialize on load for other preferred location
    if (document.getElementById('loc-others') && document.getElementById('loc-others').checked) {
        otherPreferredLocationField.style.display = 'block';
        if (otherPreferredLocationField.querySelector('input')) {
            otherPreferredLocationField.querySelector('input').required = true;
        }
    }

    // Toggle 'Other Sector' field for multi-select checkbox
    const sectorCheckboxes = document.querySelectorAll('.sector-checkbox');
    const otherSectorField = document.getElementById('otherSectorField');

    sectorCheckboxes.forEach(checkbox => {
        checkbox.addEventListener('change', function() {
            const othersChecked = document.getElementById('sector-others').checked;
            otherSectorField.style.display = othersChecked ? 'block' : 'none';
            if (otherSectorField.querySelector('input')) {
                otherSectorField.querySelector('input').required = othersChecked;
            }
        });
    });
    // Initialize on load for other sector
    if (document.getElementById('sector-others') && document.getElementById('sector-others').checked) {
        otherSectorField.style.display = 'block';
        if (otherSectorField.querySelector('input')) {
            otherSectorField.querySelector('input').required = true;
        }
    }

    // Toggle 'Other Department' field for multi-select checkbox
    const departmentCheckboxes = document.querySelectorAll('.department-checkbox');
    const otherDepartmentField = document.getElementById('otherDepartmentField');

    departmentCheckboxes.forEach(checkbox => {
        checkbox.addEventListener('change', function() {
            const othersChecked = document.getElementById('dept-others').checked;
            otherDepartmentField.style.display = othersChecked ? 'block' : 'none';
            if (otherDepartmentField.querySelector('input')) {
                otherDepartmentField.querySelector('input').required = othersChecked;
            }
        });
    });
    // Initialize on load for other department
    if (document.getElementById('dept-others') && document.getElementById('dept-others').checked) {
        otherDepartmentField.style.display = 'block';
        if (otherDepartmentField.querySelector('input')) {
            otherDepartmentField.querySelector('input').required = true;
        }
    }


    // Call connection status handling
    const callConnection = document.getElementById('callConnection');
    const connectedFields = document.getElementById('connectedFields');

    function toggleConnectedFields() {
        if (callConnection && callConnection.value === 'Connected') {
            connectedFields.style.display = 'flex'; // Use flex for row layout
            connectedFields.querySelectorAll('select, textarea').forEach(el => {
                el.required = false; // Make required when visible
            });
        } else {
            connectedFields.style.display = 'none';
            connectedFields.querySelectorAll('select, textarea').forEach(el => {
                el.required = false; // Not required when hidden
                el.value = ''; // Clear values when hidden
            });
            // Also ensure "Other" text fields are cleared and hidden if the main select changes
            otherInputMappings.filter(m => m.containerId === 'otherLeadGenerateContainer' || m.containerId === 'otherInterviewStatusContainer').forEach(m => {
                const container = document.getElementById(m.containerId);
                if (container) {
                    container.style.display = 'none';
                    if (container.querySelector('input')) container.querySelector('input').value = '';
                }
            });
        }
    }

    if (callConnection) {
        callConnection.addEventListener('change', toggleConnectedFields);
        toggleConnectedFields(); // Initialize on load
    }

    // Selection status handling
    const selectionStatus = document.getElementById('selectionStatus');
    const selectionFields = document.getElementById('selectionFields');
    const joiningStatus = document.getElementById('joiningStatus');
    const joinedFields = document.getElementById('joinedFields');

    function toggleSelectionFields() {
        if (!selectionStatus) return;

        const isSelected = selectionStatus.value === 'Selected';
        selectionFields.style.display = isSelected ? 'flex' : 'none'; // Use flex for row layout

        if (isSelected) {
            selectionFields.querySelectorAll('select, input').forEach(el => {
                if (el.name !== 'company_name' && el.name !== 'job_title') { // Company Name and Job Profile are optional here
                    el.required = false;
                }
            });
        } else {
            selectionFields.querySelectorAll('select, input').forEach(el => {
                el.required = false;
                if (el.type !== 'file') el.value = '';
            });
            // Hide and clear joined fields if not selected
            joinedFields.style.display = 'none';
            joinedFields.querySelectorAll('input').forEach(el => { el.required = false; el.value = ''; });
            // Clear company and job title if not selected
            document.querySelector('select[name="company_name"]').value = '';
            document.querySelector('select[name="job_title"]').value = '';
        }

        if (isSelected && joiningStatus && joiningStatus.value === 'Joined') {
            joinedFields.style.display = 'flex'; // Use flex for row layout
            joinedFields.querySelectorAll('input').forEach(el => { el.required = true; });
        } else {
            joinedFields.style.display = 'none';
            joinedFields.querySelectorAll('input').forEach(el => { el.required = false; el.value = ''; });
        }
    }

    if (selectionStatus) {
        selectionStatus.addEventListener('change', toggleSelectionFields);
        toggleSelectionFields(); // Initialize on load
    }

    if (joiningStatus) {
        joiningStatus.addEventListener('change', toggleSelectionFields);
    }

    // Date validation for selection and joining dates
    const selectionDateInput = document.querySelector('input[name="selection_date"]');
    const joiningDateInput = document.querySelector('input[name="candidate_joining_date"]');
    const payoutDateInput = document.querySelector('input[name="payout_date"]');

    function validateSelectionDates() {
        if (selectionDateInput && selectionDateInput.value && joiningDateInput && joiningDateInput.value) {
            const selectionDate = new Date(selectionDateInput.value);
            const joiningDate = new Date(joiningDateInput.value);
            
            if (joiningDate < selectionDate) {
                joiningDateInput.setCustomValidity('Joining date must be after selection date');
            } else {
                joiningDateInput.setCustomValidity('');
            }
            joiningDateInput.reportValidity();
        }
        
        if (joiningDateInput && joiningDateInput.value && payoutDateInput && payoutDateInput.value) {
            const joiningDate = new Date(joiningDateInput.value);
            const payoutDate = new Date(payoutDateInput.value);
            
            if (payoutDate < joiningDate) {
                payoutDateInput.setCustomValidity('Payout date must be after joining date');
            } else {
                payoutDateInput.setCustomValidity('');
            }
            payoutDateInput.reportValidity();
        }
    }

    if (selectionDateInput) selectionDateInput.addEventListener('change', validateSelectionDates);
    if (joiningDateInput) joiningDateInput.addEventListener('change', validateSelectionDates);
    if (payoutDateInput) payoutDateInput.addEventListener('change', validateSelectionDates);

    // Character counter for remarks
    const remarkTextarea = document.querySelector('textarea[name="calling_remark"]');
    const remarkCounter = document.getElementById('remarkCounter');

    if (remarkTextarea && remarkCounter) {
        remarkTextarea.addEventListener('input', function() {
            const remaining = 500 - this.value.length;
            remarkCounter.textContent = remaining;
            
            if (remaining < 0) {
                this.setCustomValidity('Maximum 500 characters allowed');
            } else {
                this.setCustomValidity('');
            }
            this.reportValidity();
        });
        
        // Initialize counter
        remarkTextarea.dispatchEvent(new Event('input'));
    }

    // Salary validation
    const currentSalaryInput = document.querySelector('input[name="current_salary"]');
    const expectedSalaryInput = document.querySelector('input[name="expected_salary"]');
    
    function validateSalaries() {
        if (currentSalaryInput && expectedSalaryInput) {
            const currentSalary = parseFloat(currentSalaryInput.value) || 0;
            const expectedSalary = parseFloat(expectedSalaryInput.value) || 0;
            
            if (expectedSalary > 0 && currentSalary > 0 && expectedSalary < currentSalary) {
                expectedSalaryInput.setCustomValidity('Expected salary should be equal to or higher than current salary');
            } else {
                expectedSalaryInput.setCustomValidity('');
            }
            expectedSalaryInput.reportValidity();
        }
    }
    
    if (currentSalaryInput) currentSalaryInput.addEventListener('input', validateSalaries);
    if (expectedSalaryInput) expectedSalaryInput.addEventListener('input', validateSalaries);

    // File validation (for all file inputs)
    function validateFileInput(input, maxSizeMB, validTypes, errorMessage) {
        if (input.files.length > 0) {
            const file = input.files[0];
            const fileSize = file.size / 1024 / 1024; // in MB
            
            let isValidType = false;
            if (Array.isArray(validTypes)) {
                isValidType = validTypes.includes(file.type);
            } else if (typeof validTypes === 'string') {
                isValidType = file.type.startsWith(validTypes); // For 'image/' or 'application/'
            }

            if (!isValidType) {
                input.setCustomValidity(errorMessage);
            } else if (fileSize > maxSizeMB) {
                input.setCustomValidity(`File size should not exceed ${maxSizeMB}MB`);
            } else {
                input.setCustomValidity('');
            }
            input.reportValidity();
        } else {
            input.setCustomValidity(''); // Clear custom validity if no file selected
        }
    }

    const photoInput = document.querySelector('input[name="candidate_photo"]');
    if (photoInput) {
        photoInput.addEventListener('change', function() {
            validateFileInput(
                this, 
                2, 
                ['image/jpeg', 'image/png', 'image/gif'], 
                'Please upload an image file (JPEG, PNG, GIF)'
            );
        });
    }

    const resumeInput = document.querySelector('input[name="candidate_resume"]');
    if (resumeInput) {
        resumeInput.addEventListener('change', function() {
            validateFileInput(
                this, 
                5, 
                ['application/pdf', 'application/msword', 'application/vnd.openxmlformats-officedocument.wordprocessingml.document'], 
                'Please upload a PDF or Word document'
            );
        });
    }

    const submitReciptInput = document.querySelector('input[name="submit_recipt"]');
    if (submitReciptInput) {
        submitReciptInput.addEventListener('change', function() {
            validateFileInput(this, 5, ['application/pdf', 'image/jpeg', 'image/png'], 'Please upload a PDF, JPG, or PNG.');
        });
    }

    const invoiceAttachmentInput = document.querySelector('input[name="invoice_attachment"]');
    if (invoiceAttachmentInput) {
        invoiceAttachmentInput.addEventListener('change', function() {
            validateFileInput(this, 5, ['application/pdf', 'image/jpeg', 'image/png'], 'Please upload a PDF, JPG, or PNG.');
        });
    }

    // Form submission for unifiedCandidateForm
    unifiedCandidateForm.addEventListener('submit', function(event) {
        // Only run checkChanges for the main submit button
        if (document.activeElement && document.activeElement.name === 'submit_all') {
            if (!checkChanges() || !unifiedCandidateForm.checkValidity()) {
                event.preventDefault();
                event.stopPropagation();
                
                const firstInvalid = unifiedCandidateForm.querySelector(':invalid');
                if (firstInvalid) {
                    firstInvalid.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    firstInvalid.focus();
                }
            }
        }
        unifiedCandidateForm.classList.add('was-validated');
    }, false);

    // Vendor Data Form Validation
    // The vendor and invoice data are now part of the main form, but we need to ensure their fields are validated correctly.
    // The `submit` event listener on `unifiedCandidateForm` will handle the validation, but we can add specific logic here.
    
    // We'll use a single submission handler for the main form.
    // The `submit_vendor_related_data` and `invoice_releted_data` hidden inputs will be used on the server side to determine which data was submitted.
    const commissionGenerationDateInput = unifiedCandidateForm.querySelector('input[name="commission_generation_date"]');
    const vendorPayoutDateInput = unifiedCandidateForm.querySelector('input[name="vendor_payout_date"]');
    const paymentDoneDateInput = unifiedCandidateForm.querySelector('input[name="payment_done_by_date"]');
    const vendorCommissionStatusSelect = unifiedCandidateForm.querySelector('select[name="vendor_commission_status"]');

    if (paymentDoneDateInput) {
        paymentDoneDateInput.max = currentDate; // Set max date to today
    }

    if (vendorCommissionStatusSelect) {
        vendorCommissionStatusSelect.addEventListener('change', function() {
            if (this.value === "Complete" && paymentDoneDateInput && !paymentDoneDateInput.value) {
                paymentDoneDateInput.value = currentDate;
            }
        });
    }

    // Invoice Data Form Validation
    const invoiceDateInput = unifiedCandidateForm.querySelector('input[name="invoice_date"]');
    if (invoiceDateInput) {
        invoiceDateInput.max = currentDate; // Set max date to today
    }

    // Interview Modals JavaScript
    const addInterviewModal = document.getElementById('addInterviewModal');
    const addInterviewForm = document.getElementById('addInterviewForm');

    if (addInterviewModal) {
        addInterviewModal.addEventListener('show.bs.modal', function () {
            // Reset the form when the modal is shown
            addInterviewForm.reset();
            addInterviewForm.classList.remove('was-validated');
            addInterviewForm.querySelectorAll('.is-invalid').forEach(el => el.classList.remove('is-invalid'));
            addInterviewForm.querySelectorAll('[required]').forEach(el => el.required = true); // Ensure required fields are set
            // Set default date/time for new interview to now
            const now = new Date();
            const year = now.getFullYear();
            const month = (now.getMonth() + 1).toString().padStart(2, '0');
            const day = now.getDate().toString().padStart(2, '0');
            const hours = now.getHours().toString().padStart(2, '0');
            const minutes = now.getMinutes().toString().padStart(2, '0');
            addInterviewForm.querySelector('input[name="interview_date_time"]').value = `${year}-${month}-${day}T${hours}:${minutes}`;
        });

        addInterviewForm.addEventListener('submit', function(event) {
            if (!addInterviewForm.checkValidity()) {
                event.preventDefault();
                event.stopPropagation();
            }
            addInterviewForm.classList.add('was-validated');
        }, false);

        addInterviewForm.querySelectorAll('input, select, textarea').forEach(input => {
            input.addEventListener('change', function() {
                this.setCustomValidity('');
                this.classList.remove('is-invalid');
            });
        });

        // Specific file validation for interview attachment
        const addInterviewAttachmentInput = addInterviewForm.querySelector('input[name="interview_attachment"]');
        if (addInterviewAttachmentInput) {
            addInterviewAttachmentInput.addEventListener('change', function() {
                validateFileInput(this, 10, ['application/pdf', 'application/msword', 'application/vnd.openxmlformats-officedocument.wordprocessingml.document', 'image/jpeg', 'image/png'], 'Please upload a PDF, Word, JPG, or PNG file (max 10MB).');
            });
        }
    }

    const editInterviewModal = document.getElementById('editInterviewModal');
    const editInterviewForm = document.getElementById('editInterviewForm');

    if (editInterviewModal) {
        editInterviewModal.addEventListener('show.bs.modal', function (event) {
            const button = event.relatedTarget; // Button that triggered the modal
            const interviewId = button.getAttribute('data-interview-id');
            const interviewDateTime = button.getAttribute('data-interview-datetime');
            const companyName = button.getAttribute('data-company-name');
            const jobPosition = button.getAttribute('data-job-position');
            const interviewerName = button.getAttribute('data-interviewer-name');
            const interviewerEmail = button.getAttribute('data-interviewer-email');
            const interviewerPhone = button.getAttribute('data-interviewer-phone');
            const status = button.getAttribute('data-status');
            const interviewMode = button.getAttribute('data-interview-mode');
            const location = button.getAttribute('data-location');
            const meetingLink = button.getAttribute('data-meeting-link');
            const notes = button.getAttribute('data-notes');
            const feedback = button.getAttribute('data-feedback');
            const rating = button.getAttribute('data-rating');
            const isTechnical = button.getAttribute('data-is-technical') === 'on';
            const duration = button.getAttribute('data-duration');
            const attachmentUrl = button.getAttribute('data-attachment-url');

            // Populate the form fields
            document.getElementById('edit_interview_id').value = interviewId;
            document.getElementById('edit_interview_date_time').value = interviewDateTime;
            document.getElementById('edit_interview_company_name').value = companyName;
            document.getElementById('edit_job_position').value = jobPosition;
            document.getElementById('edit_interviewer_name').value = interviewerName;
            document.getElementById('edit_interviewer_email').value = interviewerEmail;
            document.getElementById('edit_interviewer_phone').value = interviewerPhone;
            document.getElementById('edit_interview_status').value = status;
            document.getElementById('edit_interview_mode').value = interviewMode;
            document.getElementById('edit_location').value = location;
            document.getElementById('edit_meeting_link').value = meetingLink;
            document.getElementById('edit_notes').value = notes;
            document.getElementById('edit_feedback').value = feedback;
            document.getElementById('edit_rating').value = rating;
            document.getElementById('edit_isTechnical').checked = isTechnical;
            document.getElementById('edit_duration').value = duration;
            document.getElementById('edit_requirements').value = button.getAttribute('data-requirements');

            const currentAttachmentDisplay = document.getElementById('current_interview_attachment_display');
            if (attachmentUrl) {
                currentAttachmentDisplay.innerHTML = `<small class="text-muted">Current file: <a href="${attachmentUrl}" target="_blank">View Attachment</a></small>`;
                document.getElementById('clear_edit_interview_attachment').checked = false; // Uncheck clear checkbox by default
            } else {
                currentAttachmentDisplay.innerHTML = '';
                document.getElementById('clear_edit_interview_attachment').checked = false;
            }

            // Reset validation states
            editInterviewForm.classList.remove('was-validated');
            editInterviewForm.querySelectorAll('.is-invalid').forEach(el => el.classList.remove('is-invalid'));
            editInterviewForm.querySelectorAll('[required]').forEach(el => el.required = true); // Ensure required fields are set
        });

        editInterviewForm.addEventListener('submit', function(event) {
            if (!editInterviewForm.checkValidity()) {
                event.preventDefault();
                event.stopPropagation();
            }
            editInterviewForm.classList.add('was-validated');
        }, false);

        editInterviewForm.querySelectorAll('input, select, textarea').forEach(input => {
            input.addEventListener('change', function() {
                this.setCustomValidity('');
                this.classList.remove('is-invalid');
            });
        });

        // Specific file validation for edit interview attachment
        const editInterviewAttachmentInput = editInterviewForm.querySelector('input[name="interview_attachment"]');
        if (editInterviewAttachmentInput) {
            editInterviewAttachmentInput.addEventListener('change', function() {
                validateFileInput(this, 10, ['application/pdf', 'application/msword', 'application/vnd.openxmlformats-officedocument.wordprocessingml.document', 'image/jpeg', 'image/png'], 'Please upload a PDF, Word, JPG, or PNG file (max 10MB).');
            });
        }
    }

    const deleteInterviewModal = document.getElementById('deleteInterviewModal');
    if (deleteInterviewModal) {
        deleteInterviewModal.addEventListener('show.bs.modal', function (event) {
            const button = event.relatedTarget; // Button that triggered the modal
            const interviewId = button.getAttribute('data-interview-id');
            document.getElementById('delete_interview_id').value = interviewId;
        });
    }

});
</script>
