{% comment %} 
This partial template represents a single row in your candidates table.
The 'candidate' object is passed from the main view.
{% endcomment %}
<tr data-id="{{ candidate.id }}">
    <td>
        <input class="form-check-input m-0 align-middle candidate-checkbox" type="checkbox" data-id="{{ candidate.id }}" data-model-type="{{ candidate.get_model_type }}">
    </td>
    <td>{{ forloop.counter }}</td>
    <td>
        {% if candidate.call_connection %}
            <span class="badge 
                {% if candidate.call_connection|lower == 'yes' or candidate.call_connection|lower == 'connected' %}bg-success text-white{% elif candidate.call_connection|lower == 'no' %}bg-danger text-white{% elif candidate.call_connection|lower == 'pending' %}bg-warning text-dark{% else %}bg-secondary text-white{% endif %} 
                px-3 py-1 rounded-pill text-capitalize">
                {{ candidate.call_connection }}
            </span>
        {% else %}
            <span class="badge bg-secondary px-3 py-1 rounded-pill">Unknown</span>
        {% endif %}
    </td>
    <td>
        <div class="d-flex align-items-center">
            <div class="me-3">
                {% if candidate.candidate_photo %}
                    <img src="{{ candidate.candidate_photo.url }}" class="avatar avatar-md rounded-circle" alt="{{ candidate.candidate_name }}">
                {% else %}
                    <div class="avatar avatar-md rounded-circle bg-blue-lt">{{ candidate.candidate_name|first|upper }}</div>
                {% endif %}
            </div>
            <div>
                <div class="font-weight-medium"><a href="{{ candidate.get_absolute_url }}" class="text-truncate profile-link">{{ candidate.candidate_name }}</a></div>
                <div class="text-muted small">
                    {% if candidate.lead_source == 'EVMS' %}
                        <code>{{ candidate.refer_code }}-{{ candidate.unique_id }}</code>
                    {% else %}
                        <code>{{ candidate.unique_code }}</code>
                    {% endif %}
                </div>
            </div>
        </div>
    </td>
    <td>
        <div class="text-muted">
            <a href="tel:{{ candidate.candidate_mobile_number }}" class="text-reset d-block">{{ candidate.candidate_mobile_number }}</a>
            {% if candidate.candidate_email_address %}
            <a href="mailto:{{ candidate.candidate_email_address }}" class="text-reset d-block small text-truncate" style="max-width: 150px;">{{ candidate.candidate_email_address }}</a>
            {% endif %}
        </div>
    </td>
    <td>
        <span class="text-muted">
            {% if candidate.lead_source == 'Other' and candidate.other_lead_source %}
                {{ candidate.other_lead_source }}
            {% else %}
                {{ candidate.lead_source|default:"-" }}
            {% endif %}
        </span>
    </td>
    <td>
        {% with lead_status=candidate.lead_generate|default:"unknown"|slugify %}
        <span class="status-badge status-{{ lead_status }}">
            {% if candidate.lead_generate == 'Other' and candidate.other_lead_generate %}
                {{ candidate.other_lead_generate }}
            {% else %}
                {{ candidate.lead_generate|default:"-" }}
            {% endif %}
        </span>
        {% endwith %}
    </td>
    <td>
        <div class="text-muted">
            {% if candidate.experience_year or candidate.experience_month %}
                {{ candidate.experience_year|default:0 }}y {{ candidate.experience_month|default:0 }}m
            {% else %}
                Fresher
            {% endif %}
        </div>
    </td>
    <td>
        <div class="text-muted">{{ candidate.employee_name|default:"Unassigned" }}</div>
        
        {% with latest_activity=candidate.activities.first %}
            {% if latest_activity and latest_activity.employee and latest_activity.employee.user.is_staff %}
                <div class="mt-1">
                    {% if latest_activity.action == 'viewed' %}
                    <span class="badge bg-purple-lt" title="Last viewed by {{ latest_activity.employee.user.username }} on {{ latest_activity.timestamp|date:'M d, Y' }}">
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-eye-check" width="16" height="16" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" /><path d="M21 12c-2.4 4 -5.4 6 -9 6c-3.6 0 -6.6 -2 -9 -6c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6" /><path d="M15 19l2 2l4 -4" /></svg>
                        Admin Viewed
                    </span>
                    {% elif latest_activity.action == 'updated' or latest_activity.action == 'call_made' %}
                    <span class="badge bg-orange-lt" title="Last updated by {{ latest_activity.employee.user.username }} on {{ latest_activity.timestamp|date:'M d, Y' }}">
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-edit" width="16" height="16" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M7 7h-1a2 2 0 0 0 -2 2v9a2 2 0 0 0 2 2h9a2 2 0 0 0 2 -2v-1" /><path d="M20.385 6.585a2.1 2.1 0 0 0 -2.97 -2.97l-8.415 8.385v3h3l8.385 -8.415z" /><path d="M16 5l3 3" /></svg>
                        Admin Edited
                    </span>
                    {% endif %}
                </div>
            {% endif %}
        {% endwith %}
        </td>
    <td class="text-muted" title="{{ candidate.register_time|date:'d M Y, h:i A' }}">{{ candidate.register_time|timesince }} ago</td>
    <td class="text-center actions-cell">
        </td>
</tr>